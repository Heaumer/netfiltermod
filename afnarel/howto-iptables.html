<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="fr-FR"><head profile="http://gmpg.org/xfn/11"><script src="howto-iptables_files/count.json" async="true" type="text/javascript"></script><link href="howto-iptables_files/buttons3.css" type="text/css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="howto-iptables_files/default.css" media="all"><script src="howto-iptables_files/buttons.js" async="" type="text/javascript"></script><script async="" src="howto-iptables_files/a"></script><script src="howto-iptables_files/widgets.js" async="" type="text/javascript"></script><script src="howto-iptables_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">function w3tc_load_js(u){var d=document,p=d.getElementsByTagName('HEAD')[0],c=d.createElement('script');c.type='text/javascript';c.src=u;p.appendChild(c);}</script><script type="text/javascript">w3tc_load_js('http://www.nbs-system.com/wp-content/w3tc/min/9a12f/default.include-nb.40975b.js');</script><script src="howto-iptables_files/default.js" type="text/javascript"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>IPtables : HOWTO français Netfilter / IPTable, Préconisations, Installation et configuration</title><link rel="icon" href="http://cdn1.nbs-system.com/wp-content/themes/nbswdp/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="http://cdn1.nbs-system.com/wp-content/themes/nbswdp/favicon.ico" type="image/x-icon"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.nbs-system.com/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.nbs-system.com/wp-includes/wlwmanifest.xml"><link rel="index" title="test d'intrusion, hébergement Magento et E-commerce" href="http://www.nbs-system.com/"><link rel="start" title="Optimisations grâce au fichier .htaccess" href="http://www.nbs-system.com/blog/technique/faq/optimisations-grace-au-fichier-htaccess.html"><link rel="prev" title="Gestion des tâches planifiées" href="http://www.nbs-system.com/blog/technique/faq/gestion-des-taches-planifiees.html"><link rel="next" title="Howto Openvpn 2" href="http://www.nbs-system.com/blog/howto-openvpn2.html"><meta name="generator" content="WordPress 3.2.1"><link rel="shortlink" href="http://www.nbs-system.com/?p=331"><meta name="description" content="IPtables : NBS System présente IPtables / Netfilter avec toutes les informations sur les firewalls, Net Filter et paquets TCP/IP."><meta name="keywords" content="blog,technique"><link rel="canonical" href="http://www.nbs-system.com/blog/howto-iptables.html"><script type="text/javascript">var icl_lang='fr';var icl_home='http://www.nbs-system.com/';</script><meta name="generator" content="WPML ver:2.3.4 stt:4,1,2;0"> <script type="text/javascript">var analyticsFileTypes=[''];var analyticsEventTracking='enabled';</script><script type="text/javascript">var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-1216399-1']);_gaq.push(['_trackPageview']);_gaq.push(['_trackPageLoadTime']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border-spacing:0;border:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size: 11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size: 24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size: 14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yO/r/_j03izEX40U.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size: 12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size: 12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size: 16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{position:relative;display:-moz-inline-block;display:inline-block}
.fb_iframe_widget iframe{position:relative;vertical-align:text-bottom}
.fb_iframe_widget span{position:relative}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_button_simple,
.fb_button_simple_rtl{background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yH/r/eIpbnVKI9lR.png);background-repeat:no-repeat;cursor:pointer;outline:none;text-decoration:none}
.fb_button_simple_rtl{background-position:right 0}
.fb_button_simple .fb_button_text{margin:0 0 0 20px;padding-bottom:1px}
.fb_button_simple_rtl .fb_button_text{margin:0 10px 0 0}
a.fb_button_simple:hover .fb_button_text,
a.fb_button_simple_rtl:hover .fb_button_text,
.fb_button_simple:hover .fb_button_text,
.fb_button_simple_rtl:hover .fb_button_text{text-decoration:underline}
.fb_button,
.fb_button_rtl{background:#29447e url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/FGFbc80dUKj.png);background-repeat:no-repeat;cursor:pointer;display:inline-block;padding:0 0 0 1px;text-decoration:none;outline:none}
.fb_button .fb_button_text,
.fb_button_rtl .fb_button_text{background:#5f78ab url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/FGFbc80dUKj.png);border-top:solid 1px #879ac0;border-bottom:solid 1px #1a356e;color:#fff;display:block;font-family:"lucida grande",tahoma,verdana,arial,sans-serif;font-weight:bold;padding:2px 6px 3px 6px;margin:1px 1px 0 21px;text-shadow:none}
a.fb_button,
a.fb_button_rtl,
.fb_button,
.fb_button_rtl{text-decoration:none}
a.fb_button:active .fb_button_text,
a.fb_button_rtl:active .fb_button_text,
.fb_button:active .fb_button_text,
.fb_button_rtl:active .fb_button_text{border-bottom:solid 1px #29447e;border-top:solid 1px #45619d;background:#4f6aa3;text-shadow:none}
.fb_button_xlarge,
.fb_button_xlarge_rtl{background-position:left -60px;font-size: 24px;line-height:30px}
.fb_button_xlarge .fb_button_text{padding:3px 8px 3px 12px;margin-left:38px}
a.fb_button_xlarge:active{background-position:left -99px}
.fb_button_xlarge_rtl{background-position:right -268px}
.fb_button_xlarge_rtl .fb_button_text{padding:3px 8px 3px 12px;margin-right:39px}
a.fb_button_xlarge_rtl:active{background-position:right -307px}
.fb_button_large,
.fb_button_large_rtl{background-position:left -138px;font-size: 13px;line-height:16px}
.fb_button_large .fb_button_text{margin-left:24px;padding:2px 6px 4px 6px}
a.fb_button_large:active{background-position:left -163px}
.fb_button_large_rtl{background-position:right -346px}
.fb_button_large_rtl .fb_button_text{margin-right:25px}
a.fb_button_large_rtl:active{background-position:right -371px}
.fb_button_medium,
.fb_button_medium_rtl{background-position:left -188px;font-size: 11px;line-height:14px}
a.fb_button_medium:active{background-position:left -210px}
.fb_button_medium_rtl{background-position:right -396px}
.fb_button_text_rtl,
.fb_button_medium_rtl .fb_button_text{padding:2px 6px 3px 6px;margin-right:22px}
a.fb_button_medium_rtl:active{background-position:right -418px}
.fb_button_small,
.fb_button_small_rtl{background-position:left -232px;font-size: 10px;line-height:10px}
.fb_button_small .fb_button_text{padding:2px 6px 3px;margin-left:17px}
a.fb_button_small:active,
.fb_button_small:active{background-position:left -250px}
.fb_button_small_rtl{background-position:right -440px}
.fb_button_small_rtl .fb_button_text{padding:2px 6px;margin-right:18px}
a.fb_button_small_rtl:active{background-position:right -458px}
.fb_share_count_wrapper{position:relative;float:left}
.fb_share_count{background:#b0b9ec none repeat scroll 0 0;color:#333;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;text-align:center}
.fb_share_count_inner{background:#e8ebf2;display:block}
.fb_share_count_right{margin-left:-1px;display:inline-block}
.fb_share_count_right .fb_share_count_inner{border-top:solid 1px #e8ebf2;border-bottom:solid 1px #b0b9ec;margin:1px 1px 0 1px;font-size: 10px;line-height:10px;padding:2px 6px 3px;font-weight:bold}
.fb_share_count_top{display:block;letter-spacing:-1px;line-height:34px;margin-bottom:7px;font-size: 22px;border:solid 1px #b0b9ec}
.fb_share_count_nub_top{border:none;display:block;position:absolute;left:7px;top:35px;margin:0;padding:0;width:6px;height:7px;background-repeat:no-repeat;background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yU/r/bSOHtKbCGYI.png)}
.fb_share_count_nub_right{border:none;display:inline-block;padding:0;width:5px;height:10px;background-repeat:no-repeat;background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yX/r/i_oIVTKMYsL.png);vertical-align:top;background-position:right 5px;z-index:10;left:2px;margin:0 2px 0 0;position:relative}
.fb_share_no_count{display:none}
.fb_share_size_Small .fb_share_count_right .fb_share_count_inner{font-size: 10px}
.fb_share_size_Medium .fb_share_count_right .fb_share_count_inner{font-size: 11px;padding:2px 6px 3px;letter-spacing:-1px;line-height:14px}
.fb_share_size_Large .fb_share_count_right .fb_share_count_inner{font-size: 13px;line-height:16px;padding:2px 6px 4px;font-weight:normal;letter-spacing:-1px}
.fb_share_count_hidden .fb_share_count_nub_top,
.fb_share_count_hidden .fb_share_count_top,
.fb_share_count_hidden .fb_share_count_nub_right,
.fb_share_count_hidden .fb_share_count_right{visibility:hidden}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size: 13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size: 11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_edge_comment_widget iframe.fb_ltr{left:-4px}
.fb_edge_widget_with_comment span.fb_edge_comment_widget iframe.fb_rtl{left:2px}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{left:0;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}
</style><script src="howto-iptables_files/nonSecureAnonymousFramework"></script><style type="text/css">* html #li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link{height:1% !important;}#li_ui_li_gen_1327413063996_0{position:relative !important;overflow:visible !important;display:block !important;}#li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link{border:0 !important;height:undefinedpx !important;text-decoration:none !important;padding:0 !important;margin:0 !important;display:inline-block !important;}#li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link:link, #li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link:visited, #li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link:hover, #li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link:active{border:0 !important;text-decoration:none !important;}#li_ui_li_gen_1327413063996_0 a#li_ui_li_gen_1327413063996_0-link:after{content:"." !important;display:block !important;clear:both !important;visibility:hidden !important;line-height:0 !important;height:0 !important;}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-logo{background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) 0px -276px no-repeat !important;cursor:pointer !important;border:0 !important;text-indent:-9999em !important;overflow:hidden !important;padding:0 !important;margin:0 !important;position:absolute !important;left:0px !important;top:0px !important;display:block !important;width:20px !important;height:20px !important;float:right !important;}#li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-logo{background-position:-20px -276px !important;}#li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-logo, #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-logo{background-position:-40px -276px !important;}.IN-shadowed #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-logo{}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title{color:#333 !important;cursor:pointer !important;display:block !important;white-space:nowrap !important;float:left !important;margin-left:1px !important;vertical-align:top !important;overflow:hidden !important;text-align:center !important;height:18px !important;padding:0 4px 0 23px !important;border:1px solid #000 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;border-left:0 !important;text-shadow:#FFFFFF -1px 1px 0 !important;line-height:20px !important;border-radius:0 !important;-moz-border-radius:0 !important;border-top-right-radius:2px !important;border-bottom-right-radius:2px !important;-moz-border-radius-topright:2px !important;-moz-border-radius-bottomright:2px !important;background-color:#ECECEC !important;background-image:-moz-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}#li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title{border:1px solid #000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;border-left:0 !important;background-color:#EDEDED !important;background-image:-moz-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}#li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title, #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title{color:#666 !important;border:1px solid #000 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;border-left:0 !important;background-color:#DEDEDE !important;background-image:-moz-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.IN-shadowed #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title{}.IN-shadowed #li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title{}.IN-shadowed #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title, .IN-shadowed #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title{}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text, #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text *{color:#333 !important;font-size:11px !important;font-family:Arial, sans-serif !important;font-weight:bold !important;font-style:normal !important;display:inline-block !important;background:transparent none !important;vertical-align:baseline !important;height:18px !important;line-height:20px !important;float:none !important;}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text strong{font-weight:bold !important;}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text em{font-style:italic !important;}#li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title-text, #li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title-text *{color:#000 !important;}#li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title-text, #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title-text, #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title-text *, #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title-text *{color:#666 !important;}#li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title #li_ui_li_gen_1327413063996_0-mark{display:inline-block !important;width:0px !important;overflow:hidden !important;}.success #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title{color:#333 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;background-color:#ECECEC !important;background-image:-moz-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}.success #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text, .success #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title-text *{color:#333 !important;}.IN-shadowed .success #li_ui_li_gen_1327413063996_0 #li_ui_li_gen_1327413063996_0-title{}.success #li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title{color:#000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;background-color:#EDEDED !important;background-image:-moz-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}.success #li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title-text, .success #li_ui_li_gen_1327413063996_0.hovered #li_ui_li_gen_1327413063996_0-title-text *{color:#000 !important;}.success #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title, .success #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title{color:#666 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;background-color:#DEDEDE !important;background-image:-moz-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.success #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title-text, .success #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title-text, .success #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title-text *, .success #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title-text *{color:#666 !important;}.IN-shadowed .success #li_ui_li_gen_1327413063996_0.clicked #li_ui_li_gen_1327413063996_0-title, .IN-shadowed .success #li_ui_li_gen_1327413063996_0.down #li_ui_li_gen_1327413063996_0-title{}#li_ui_li_gen_1327413064014_1-container.IN-top {display:inline-block !important;overflow:visible !important;position:relative !important;height:42px !important;line-height:1px !important;cursor:pointer !important;}#li_ui_li_gen_1327413064014_1.IN-top {display:inline-block !important;height:42px !important;width:57px !important;background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) -150px top no-repeat !important;}#li_ui_li_gen_1327413064014_1-content.IN-top {display:inline !important;font-size:16px !important;color:#04558B !important;font-weight:bold !important;font-family:Arial, sans-serif !important;line-height:34px !important;}#li_ui_li_gen_1327413064014_1-container.IN-hovered #li_ui_li_gen_1327413064014_1.IN-top, #li_ui_li_gen_1327413064014_1-container.IN-clicked #li_ui_li_gen_1327413064014_1.IN-top, #li_ui_li_gen_1327413064014_1-container.IN-down #li_ui_li_gen_1327413064014_1.IN-top {background-position-x:-210px !important;}#li_ui_li_gen_1327413064014_1-container.IN-empty #li_ui_li_gen_1327413064014_1-inner.IN-top {background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) 0px -20px no-repeat !important;overflow:hidden !important;margin:5px auto 0 auto !important;width:26px !important;height:26px !important;display:block !important;}#li_ui_li_gen_1327413064014_1-container.IN-empty #li_ui_li_gen_1327413064014_1-content.IN-top {text-indent:-999px !important;display:inline-block !important;}#li_ui_li_gen_1327413064014_1-container.IN-hidden #li_ui_li_gen_1327413064014_1 {display:none !important;}</style></head><body data-rendering="true" class="single single-post postid-331 single-format-standard"><iframe src="howto-iptables_files/hub.htm" style="position: absolute; top: -9999em; width: 10px; height: 10px;" name="twttrHubFrame" tabindex="0" allowtransparency="true" id="twttrHubFrame" frameborder="0" scrolling="no"></iframe><div id="wrapper"><div id="container"><div id="main" class="divcenter clearfix narrowcolumn" role="main"><div id="page-content"><div class="header"></div><div class="content"><div class="post-331 post type-post status-publish format-standard hentry category-blog category-technique" id="post-331"><div class="date"> <span class="month">mai</span><br> <span class="day">4</span></div><h1> <a href="http://www.nbs-system.com/blog/howto-iptables.html" rel="bookmark" title="Permanent Link to Howto Iptables / Netfilter"> Howto Iptables / Netfilter </a></h1><div class="entry"><h1 id="top" style="padding-top: 10px;">IPtables HOWTO français</h1><p class="large">Préconisations, Installation, configuration.<br> Par Philippe Humeau (philippe.humeau@nbs-system.com) le 18/03/2005</p><div class="sommaire" style="width: 600px;"><ol><li><a href="http://www.nbs-system.com/blog/howto-iptables#intro_fw">Introduction sur les Firewalls</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#packet_life">Les paquets TCP/IP, leur vie, leur format</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#nf_ipt">NetFitler / Iptables</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#conf_kern">Configurer son noyau pour Netfilter</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#packet_path">Cheminement des paquets dans le filtre</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#input_output">Les chaînes INPUT et OUTPUT</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#forward">La chaîne FORWARD</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#dnat_snat">Le DNAT / SNAT</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#dnat_snat_ex">Un exemple de SNAT/DNAT couplés</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#usefull_cmd">Quelques commandes indispensables</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#ipt_syntax">La syntaxe d’iptables</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#case_study">Quelques cas classiques</a></li><li><a href="http://www.nbs-system.com/blog/howto-iptables#practice">Un script de Firewalling iptables pour une machine personnelle sur ADSL</a></li></ol></div><h2 id="intro_fw"><span id="more-331"></span>1. Introduction sur les Firewalls</h2><p class="howto">Les
 firewalls servent à filtrer les paquets. Jusqu’ici, si vous êtes 
entrain de lire cette page, j’ai bien conscience de ne rien vous 
apprendre. Mais certains principes de base méritent toujours d’être 
rappelés&nbsp;:</p><p class="howto">Un firewall doit être imprenable car sinon votre réseau entier est compromis.</p><p class="howto">Un
 firewall efficace doit posséder plusieurs interfaces réseau pour 
pouvoir faire un filtrage entre plusieurs zones. L’idéal c’est qu’à 
chaque zone du SI (Système d’Information) corresponde une interface. Par
 exemple, une pour la connexion internet, une pour la DMZ (Démilitarized
 Zone, zone des serveurs visible depuis Internet, possédant une IP 
Publique), et une pour le LAN. De cette façon vous pourrez filtrer plus 
finement les connexions entrantes et sortantes du SI.</p><p class="howto">Plus la granularité est fine, meilleure  sera <a style="text-decoration: none; color: rgb(0, 0, 0);" href="http://www.nbs-system.com/">la </a><a style="text-decoration: none; color: rgb(0, 0, 0);" href="http://www.nbs-system.com/">sécurité informatique</a> .</p><p class="howto"><strong> </strong>Dernière
 règle souvent oubliée&nbsp;: La première chose à faire dans un 
Firewall&nbsp;c’est de tout refuser et ensuite de n’accepter que les 
flux nécessaires… Tout autre approche de la configuration d’un firewall 
d’un point de vue sécurité est folklorique voire inutile.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="packet_life">2. Les paquets TCP/IP, leur vie, leur format</h2><p class="howto">Voici le format d’un paquet&nbsp;: (d’après la RFC 791)</p><p><img src="howto-iptables_files/ipt1.png" alt="Représentation d'un paquet TCP/IP"></p><p class="howto">Il
 est composé d’une en tête IP puis éventuellement (si c’est un paquet 
TCP, si le champ protocole est à 6), d’une en tête TCP. On y retrouve 
les champs qui vont nous permettre de filtrer les paquets ultérieurement
 avec Netfilter. Notamment&nbsp;: adresse source, adresse destination et
 si c’est un paquet TCP, port source, port destination (en UDP aussi), 
numéro de séquence, les flags, la fenêtre, le checksum et les options. 
Il serait un peu long de faire un cours sur tous ces champs et ce n’est 
pas le but de ce Howto, mais nous reviendrons sur certains d’entre eux 
plus tard dans le document.</p><ul class="howto"><li>Un petit rappel sur
 le modèle OSI n’est pas forcément inutile non plus pour avoir toute les
 base et bien savoir de quoi on parle.</li><li>Le modèle OSI comporte 7 couches&nbsp;:</li><li>La couche 1 est le support physique, celui qui transmet, le câble, les ondes etc…</li><li>La
 couche 2 est la liaison de données, celle qui module ou encode la 
donnée pour qu’elle puisse être transportée par la couche 1.</li><li>La couche 3 est la couche réseau, celle qui adresse les données.</li><li>La couche 4 est la couche de transport, celle qui s’occupe de l’acheminement.</li><li>La couche 5 est la couche de session, celle qui établie les dialogues.</li><li>La
 couche 6 est la couche de présentation, elle s’occupe de l’abstraction 
pour que tout le monde comprenne la communication peut importe le 
matériel ou le logiciel.</li><li>La couche 7 est la couche applicative, les protocoles de communication, web, mail, ftp, etc…</li><li>Nous allons essentiellement nous intéresser aux couches 3, 4 et 5 dans ce Howto</li></ul><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="nf_ipt">3. NetFilter / Iptables</h2><p class="howto">Netfilter
 est l’implémentation noyau du firewall sous Linux. Un certain codeur 
talentueux du nom de Rusty Russel a estimé qu’il était nécessaire 
d’avoir un remplaçant au fameux ipfilter et de pouvoir rivaliser voir 
dépasser largement les firewalls commerciaux.</p><p class="howto">Actuellement,
 d’après mes connaissances, Netfilter est l’un des firewall des plus 
puissants du marché. Il est souple, simple à configurer et très 
largement supporté par la communauté.</p><p class="howto">Iptables est la commande permettant de paramétrer le filtre Netfilter du noyau et donc de configurer son firewall.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="conf_kern">4. Configurer son noyau pour Netfilter</h2><p class="howto">Pour
 pouvoir utiliser les fonctionnalités Netfilter du noyau Linux, il faut 
activer les options suivantes lors de la configuration du noyau&nbsp;:</p><p class="howto">J’utilise
 le kernel 2.6.10, notamment pour sa robustesse avec le patch GRsec 
2.1.0 qui est disponible pour cette version du kernel au moment de 
l’écriture de ce Howto.</p><p class="howto">Pour de multiples raisons 
trop longues à décrire ici, le patch GRsec est incontournable en terme 
de sécurité Linux, je vous conseille donc de le mettre en place, même si
 ce n’est pas du tout indispensable pour l’utilisation de Netfilter</p><p class="howto">Si vous voulez Grsec récupérez le sur <a href="http://www.grsecurity.net/">http://www.grsecurity.net/</a>:<br> <a href="http://www.grsecurity.net/grsecurity-2.1.0-2.6.10-200501081640.patch">http://www.grsecurity.net/grsecurity-2.1.0-2.6.10-200501081640.patch</a> (pour le 2.1.0 pour le kernel 2.6.10)</p><p class="howto">Le kernel est disponible sur : <a href="ftp://ftp.kernel.org/">ftp.kernel.org</a><br> <a href="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-2.6.10.tar.gz">ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-2.6.10.tar.gz</a> (pour le kernel 2.6.10)</p><p class="howto">Ensuite,
 déplacer les fichers grsecurity-2.1.0-2.6.10-200501081640.patch et 
linux-2.6.10.tar.gz archives dans /usr/src puis tapez :</p><div class="thecode">tar zxvf linux-2.6.10.tar.gz<br> patch -p0 &lt; grsecurity-2.1.0-2.6.10-200501081640.patch</div><p class="howto">Vous devriez maintenant avoir une arborescence des sources du kernel patchées avec GRsec.</p><p class="howto">Ensuite :</p><div class="thecode">cd linux-2.6.10 &amp;&amp; make menuconfig</div><p class="howto">Configurez votre kernel selon les besoins de votre machine et mettez les options suivantes :</p><p class="howto">Activez les options suivantes :</p><div class="thecode">Device
 Drivers -&gt; Networking support -&gt; Networking Options -&gt; Network
 Packet Filtering (replace ipchains) -&gt; IP : Netfilter configuration</div><p class="howto">Toutes
 les options et sous options, pas de soucis, même si globalement 
iptables support / NAT / MASQUERADE / IP range match support / Limit 
match support / connection state / Reject / NAT of local connexion / 
Log.</p><div class="thecode">(si vous avez patché avec GRsec) :<br> Security Options<br> -&gt; GRsecurity<br> -&gt; Adress Space Protection<br> -&gt; Deter Exploit brutforcing<br> -&gt; FileSystem protection<br> -&gt; Chroot jail restriction (tout)<br> -&gt; executable protection<br> -&gt; randomized PID<br> -&gt; Network protection<br> -&gt; (larger entropy pool, truly random tcp isn, random IP ids)<br> -&gt; sysctl support<br> -&gt; sysctl support<br> -&gt; PaX<br> -&gt; PaX control<br> -&gt; Use ELF program header Marking<br> -&gt; Non executable pages<br> -&gt; enforce non-executable pages<br> -&gt; segmentation based non-exec pages<br> -&gt; enforce non-executable kernel pages<br> -&gt; address space layout randomization<br> -&gt; Randomize kernel stack base</div><p class="howto">Et ce qui vous semblera pertinent selon votre configuration.</p><p class="howto">Enfin :</p><div class="thecode">make bzImage &amp;&amp; make install</div><p class="howto">ou si vous ne désirez pas utiliser l’installeur standard:</p><div class="thecode">cp arch/i386/boot/bzImage /boot</div><p class="howto">et modifiez ou relancez votre bootloader.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="packet_path">5. Cheminement des paquets dans le filtre</h2><p class="howto">Les paquets qui rentrent ou sortent du firewall sont soumis à un examen très précis par le noyau.</p><p class="howto">Il
 est indispensable de bien comprendre le cheminement des paquets à 
travers les chaînes si l’on ne veut pas se ruiner en achat de tubes 
d’aspirine par la suite&nbsp;:</p><p><img src="howto-iptables_files/ipt2.png" alt="Représentation du cheminement d'un paquet" height="709" width="700"></p><p class="howto">Quand
 un nouveau paquet arrive, il est d’abord inspecté pour savoir sa source
 et sa destination. Le firewall confronte ces informations avec ses 
propres règles et détermine s’il s’agit d’un paquet «&nbsp;en 
transit&nbsp;», c’est à dire qui ne fait que passer d’une de ses 
interfaces à une autre, ou s’il lui est adressé.</p><p class="howto">Si 
le paquet lui est adressé il est confronté au filtre INPUT sinon il 
passera dans le filtre FORWARD de toute façon (même en cas de NAT, voir 
plus bas).</p><p class="howto">Si le paquet sort du firewall c’est la chaîne OUTPUT qui est concernée.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="input_output">6. Les chaînes INPUT et OUTPUT</h2><p class="howto">Les
 chaînes Input et Output sont simplissimes. Il s’agit tout simplement 
des connexions à destination et depuis le firewall à lui-même. Ces 
connexions peuvent arriver et sortir par différentes cartes réseau, mais
 c’est le firewall lui-même qui est concerné par ces filtres.</p><p class="howto">Un exemple tout simple pour illustrer le propos&nbsp;:</p><div class="thecode">Iptables –I INPUT –p tcp –dport 80 –j ACCEPT</div><p class="howto">Cette ligne autorise les connexions sur le port 80 de la machine concernée. (Serveur Web)</p><div class="thecode">Iptables –I OUTPUT –p tcp –dport 80 –j ACCEPT</div><p class="howto">Cette ligne autorise les connexions vers des serveurs sur le port 80 en tcp (le Websurf).</p><p class="howto">Petite
 note&nbsp;: Même pour un serveur linux qui n’est pas spécialisé en 
firewall, il peut être intéressant d’utiliser iptables pour faire un 
filtrage. Par exemple pour n’autoriser que certaines machines à se 
connecter en Web, FTP ou en SSH.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="forward">7. La chaîne FORWARD</h2><p class="howto">La
 chaîne FORWARD est de loin la plus intéressante. Elle est faite pour 
filtrer le trafic transitant entre deux interfaces réseau. Par 
exemple&nbsp;si un paquet est reçu par la carte de connexion à Internet 
et qu’il doit aller vers un serveur de mail par la carte 
«&nbsp;DMZ&nbsp;», alors ce paquet transit dans la chaîne FORWARD.</p><p class="howto">Exemple&nbsp;par IP :</p><div class="thecode">iptables –I FORWARD –s 14.15.16.21 –d 192.168.0.2 –j ACCEPT</div><p class="howto">Ou par interface&nbsp;:</p><div class="thecode">iptables –I FORWARD –i eth0 –o eth1 –j ACCEPT</div><p class="howto">Il est bien sur possible de multiplier les paramètres pour plus de précision (et donc de sécurité), par exemple :</p><div class="thecode">iptables –FORWARD –i eth0 –s 14.15.16.21 –o eth1 –d 192.168.0.2 –p tcp –dport 80 –j ACCEPT</div><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="dnat_snat">8. Le DNAT / SNAT</h2><p class="howto">Le
 SNAT (Source Network Adresse Translation) et le DNAT (Destination 
Network Adresse Translation) sont deux techniques très utiles permettant
 de substituer le firewall à la machine émettant ou recevant une 
requête. Illustrons cela par un schéma pour plus de 
clarté&nbsp;(l’exemple est fait sur le DNAT, mais le SNAT fait 
exactement la même chose à l’envers)&nbsp;:</p><p><img src="howto-iptables_files/ipt3.png" alt="" height="1005" width="728"></p><p class="howto">Bon, ça à l’air compliqué mais rassurez vous, ça ne l’est pas.</p><p class="howto">Voici ce qui se passe&nbsp;step by step&nbsp;:</p><p class="howto">Une
 machine envoie une requête à destination de votre firewall, mais vous 
ne souhaitez pas que ce soit le firewall qui s’occupe de cette connexion
 mais plutôt une machine de votre LAN (par exemple pour une prise de 
commande à distance comme VNC ou TSE).</p><p class="howto">Rien de plus simple. Prenons l’exemple de VNC&nbsp;:</p><p class="howto">Le Firewall, avec une règle spécifique au DNAT va s’en charger.</p><div class="thecode">iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 5900 –j DNAT –to 192.168.0.2:5900</div><p class="howto">Il
 ne vous reste plus qu’à contacter votre firewall sur le port 5900 et le
 paquet est directement rerouté vers la machine du LAN dont vous voulez 
prendre le contrôle. Enfin pour que ca marche, il vous faut quand même 
une rêgle qui va bien dans le filtre FORWARD&nbsp;:</p><div class="thecode">iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.2 –dport 5900 –j ACCEPT</div><p class="howto">Et
 voila le tour est joué. Comme il s’agit de prendre le contrôle à 
distance d’une machine du LAN, la prudence extrême s’impose, d’oû le –s 
14.15.16.21 qui limite à cette IP et à elle seule la possibilité de 
prendre le contrôle à distance en VNC de la machine. (Pour plus de 
sécurité on pensera à crypter le tuyau VNC avec un stunnel entre les 
deux firewall, mais ce n’est pas le débat du jour)</p><p class="howto">Le cheminement du paquet est le suivant&nbsp;:</p><p class="howto">La machine source émet le paquet.</p><p class="howto">Le
 firewall change le champ IP de destination du paquet et met celle de la
 machine du LAN à la place et change aussi l’IP source par la sienne. Il
 garde une trace de cette substitution dans une table. (Ensuite si une 
règle Forward l’autorise, il transmet le paquet à la machine du LAN)</p><p class="howto">Il
 envoi le paquet à la machine du LAN et quand celle-ci lui répond, il 
remet l’IP de destination de la machine source et la sienne en IP 
source.</p><p class="howto">Vous ne voulez pas utiliser le port habituel de VNC pour cacher un peu tout ça ?</p><div class="thecode">iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 23230 –j DNAT –to 192.168.0.2:5900<br> iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.2 –dport 5900 –j ACCEPT</div><div class="thecode">Vous
 appelez maintenant l’ip public de votre firewall mais sur le port 23230
 pour attérir au final sur votre machine LAN sur le port 5900.</div><p class="howto">Vous en voulez plusieurs des machines en VNC ? Pas de soucis&nbsp;:</p><div class="thecode">iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 2323 –j DNAT –to 192.168.0.2:5900<br> iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.2 –dport 5900 –j ACCEPT<br> iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 2324 –j DNAT –to 192.168.0.3:5900<br> iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.3 –dport 5900 –j ACCEPT<br> iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 2325 –j DNAT –to 192.168.0.4:5900<br> iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.4 –dport 5900 –j ACCEPT<br> iptables –I PREROUTING –t nat –p tcp –i eth0 –s 14.15.16.21 –dport 2326 –j DNAT –to 192.168.0.5:5900<br> iptables –I FORWARD –p tcp –i eth0 –s 14.15.16.21 –d 192.168.0.5 –dport 5900 –j ACCEPT</div><p class="howto">Et voila, en appelant sur 2323 vous tombez sur 192.168.0.2, sur 2324 c’est 192.168.0.3 etc…</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="dnat_snat_ex">9. Un exemple de SNAT/DNAT couplés :</h2><p class="howto">Ou, comment faire une DMZ sans mettre d’IP publics directement aux machines…</p><p class="howto">Admettons que nous ayons un serveur de mail avec en théorie comme IP 12.13.14.15 et un firewall en 12.13.14.254.</p><p class="howto">On
 va mettre à notre serveur Mail un IP privée, par exemple 192.168.0.15 
et sur la carte DMZ du firewall on va mettre 192.168.0.254. Ensuite avec
 un SNAT et un DNAT, le tour est joué&nbsp;:</p><p class="howto">(eth0 = Wan, eth1=Lan dans l’exemple)</p><div class="thecode">iptables –t nat –I PREROUTING –i eth0 –d 12.13.14.15 –p tcp –dport 25 –j DNAT –to 192.168.0.15<br> iptables –t nat –I POSTROUTING –o eth0 –s 192.168.0.15 –p tcp –sport 25 –j SNAT –to 12.13.14.15</div><p class="howto">Notre
 serveur de mail répond bien sur le port 25 à l’adresse 12.13.14.15, 
mais en fait il a une adresse IP privé en 192.168.0.15 (si si, ca peut 
très être utile en sécurité).</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="usefull_cmd">10. Quelques commandes indispensables</h2><p class="howto">Bon évidemment, iptables mais on y reviendra.</p><div class="thecode">iptables-save</div><p class="howto">Cette commande sauve l’état actuel de votre Netfilter dans un fichier.</p><p class="howto">(iptables-save &gt; firewall.rules)</p><div class="thecode">iptables-restore</div><p class="howto">Cette commande restaure le contenu de votre firewall à partir d’un fichier</p><p class="howto">(iptables-restore &lt; firewall.rules)</p><p class="howto">tcptrack
 et tcpdump sont des amis précieux pour voir l’état de vos connexions et
 du trafic et potentiellement pour débugger votre firewall. (apt-get 
install tcptrack tcpdump sur debian)</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="ipt_syntax">11. La syntaxe d’iptables</h2><p class="howto">Iptable
 est beaucoup plus complet que ce je vais présenter ici. Sa syntaxe est 
aussi plus complète, mais le but de ce howto est de pouvoir faire son 
firewall, pas de connaître par cœur toutes les options, mêmes les moins 
usités.</p><div class="thecode"><strong>Iptables –[PIADR] [INPUT|FORWARD|OUTPUT] ……….. –j [LOG|DROP|ACCEPT| MASQUERADE]</strong><br> -I = insert rule, on ajoute un règle en tête du filtre.<br> -A = append rule, on ajoute une règle à la fin du filtre.<br> -D = delete, on efface une règle.<br> -R = replace, on remplace un règle.<br> -L = list, on liste un chaîne.<br> -F = flush, on efface les règle d’une chaîne.<br> -P = Policy, réaction par défaut.</div><p class="howto">Il en existe d’autres mais dans l’immédiat ces actions nous suffirons.</p><p class="howto">Ensuite on a la chaîne concernée. INPUT / FORWARD / OUTPUT, mais il est possible d’en créer.</p><p class="howto">Les éléments de syntaxe suivants servent à préciser les règles&nbsp;:</p><ul class="howto"><li>-s ip source</li><li>-d ip cible</li><li>-p type de protocol (tcp/udp/…)</li><li>-dport port de destination</li><li>-sport port source</li><li>-m type de match (par exemple state)</li><li>–state (NEW, ESTABLISHED, RELATED)</li></ul><p class="howto">Ce
 sont les états des connexions, NEW nouvelle connexion, ESTABLISHED, 
connexion déjà établie, RELATED, connexion qui a un lien avec une autre 
(par exemple le port 20 (data) du FTP est related à une connexion sur le
 port 21)</p><ul class="howto"><li>-t nom de la table concernée par l’action</li><li>-i interface (carte réseau) d’entrée</li><li>-o interface (carte réseau) de sortie</li><li>-n sans résolution de nom</li><li>-v verbose, iptables raconte sa vie avec plus de détails</li></ul><p class="howto">Ensuite viennent les actions à mener en fonction des détails de la règle&nbsp;:</p><p class="howto">LOG / DROP / ACCEPT. Il en existe bien d’autre, mais je ne les détaillerai pas ici.</p><p class="howto">MASQUERADE
 cependant est importante car elle permet de faire du masquerading du 
réseau local, pour faire court, c’est ce dont vous avez besoin pour 
permettre au LAN de surfer. (c’est du NAT aussi)</p><p class="howto">Quelques exemples de syntaxe&nbsp;:</p><div class="thecode">iptables –t nat –L</div><p class="howto">Liste les règles concernant des SNAT/DNAT</p><div class="thecode">iptables –L -n</div><p class="howto">Liste les autres règles sans la résolution des noms</p><div class="thecode">iptables –I INPUT –s 12.13.14.15 –j DROP</div><p class="howto">Dégage tous les paquets provenant de 12.13.14.15 à destination du firewall</p><div class="thecode">iptables –I OUTPUT –p tcp –dport 80 –d 12.13.14.15 –j ACCEPT</div><p class="howto">Autorise le firewall à se connecter en port 80 sur 12.13.14.15 uniquement.</p><div class="thecode">iptables –F INPUT</div><p class="howto">Vide les règles du filtre INPUT</p><div class="thecode">iptables –P INPUT DROP</div><p class="howto">Règle la police par défaut à drop sur le filtre INPUT</p><p class="howto">Dans
 tous les cas, il faut régler la policy par défaut à DROP sur tous les 
filtres et ensuite accepter seulement les flux 
«&nbsp;licites&nbsp;»&nbsp;:</p><div class="thecode">iptables -P INPUT DROP<br> iptables -P OUTPUT DROP<br> iptables -P FORWARD DROP</div><p class="howto">De
 cette façon, si vous avez oublié une règle, dans le pire cas le paquet 
sera dropé, mais il n’atteindra pas sa destination. En gros tout ce qui 
n’est pas explicitement autorisé est interdit.</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="case_study">12. Quelques cas classiques</h2><p class="howto">Je souhaite pouvoir héberger un dns/mail/http/ftp sur ma machine qui fait aussi firewall&nbsp;:</p><div class="thecode">Mail&nbsp;: iptable –i INPUT –p tcp –dport 25 –j ACCEPT<br> DNS&nbsp;: iptable –i INPUT –p udp –dport 53 –j ACCEPT</div><p class="howto">(ajouter le tcp si vous faite du transfert de zone)</p><div class="thecode">http&nbsp;: iptable –i INPUT –p TCP –dport 80 –j ACCEPT<br> ftp&nbsp; : iptable –i INPUT –p TCP –dport 21 –m state –state NEW –j ACCEPT<br> iptable –i INPUT –p TCP –dport 20 –m state –state RELATED –j ACCEPT</div><p class="howto">Je souhaite pouvoir héberger un dns/mail/http/ftp sur une machine dédié autre que le firewall&nbsp;:</p><div class="thecode">iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 25 –j DNAT –to [ip privé serveur mail]<br> iptables –t nat –I POSTROUTING –s [ip privé serveur mail] –p tcp –sport 25 –j SNAT –to [ip firewall]</div><p class="howto">Je
 ne suis pas pour ou contre le peer to peer (P2P), mais j’en ai marre 
qu’on me pose la question, donc&nbsp;pour Emule / Edonkey&nbsp;/ 
Bittorrent et autre&nbsp;:</p><p class="howto">iptable et emule ou edonkey / overnet :</p><div class="thecode">iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 4661 –j DNAT –to [ip machine LAN]<br> iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 4881 –j DNAT –to [ip machine LAN]<br> iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 4242 –j DNAT –to [ip machine LAN]<br> iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 4662 –j DNAT –to [ip machine LAN]<br> iptables –t nat –I PREROUTING –d [ip firewall] –p udp –dport 4665 –j DNAT –to [ip machine LAN]<br> iptables –t nat –I PREROUTING –d [ip firewall] –p udp –dport 4672 –j DNAT –to [ip machine LAN]<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p tcp –dport 4661 –j ACCEPT<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p tcp –dport 4881 –j ACCEPT<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p tcp –dport 4242 –j ACCEPT<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p tcp –dport 4662 –j ACCEPT<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p udp –dport 4665 –j ACCEPT<br> iptables – I FORWARD –s [ip firewall] –d [ip machine LAN] –p udp –dport 4672 –j ACCEPT</div><p class="howto">iptable et Bittorrent :</p><div class="thecode">iptables –t nat –I PREROUTING –d [ip firewall] –p tcp –dport 6881:6999 –j DNAT –to [ip privé serveur mail]<br> iptables – I FORWARD –d [ip firewall] –p tcp –dport 6881:6999 –j DNAT –to [ip privé serveur mail]</div><p class="howto">De façon général, dans /etc/services, vous avez la plupart des ports de décrits.</p><p class="howto">Je veux le firewall le plus simple possible pour que mon LAN puisse surfer en toute sécurité&nbsp;:</p><div class="thecode">iptables -P INPUT DROP<br> iptables -P OUTPUT DROP<br> iptables -P FORWARD DROP<br> iptables -F INPUT<br> iptables -F OUTPUT<br> iptables -F FORWARD<br> iptables -I FORWARD –i eth1 –o eth0 -m state –state NEW,ESTABLISHED,RELATED -j ACCEPT<br> iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br> echo 1 &gt; /proc/sys/net/ipv4/ip_forward</div><p class="howto">(si eth0 est la connexion au net, sinon mettre eth1 ou ppp0 en fonction)</p><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><h2 id="practice">13. Un script de Firewalling iptables pour une machine personnelle sur ADSL</h2><p>(à stocker dans /etc/init.d/firewall)</p><div class="thecode">#!/bin/sh<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>case «&nbsp;$1″ in start)<br> date=`date +’%b %d %k:%M:%S’`;<br> echo &nbsp;» «&nbsp;<br> echo -e «&nbsp;———–&gt; \033[40m\033[1;32mADSL Firewalling Script V1.9\033[0m &lt;--------------"<br> echo -e "---------&gt; \033[40m\033[1;32mLast Updated on 02/01/2005\033[0m &lt;----------"<br> echo -e "---------&gt; \033[40m\033[1;33mStarting on $date \033[0m &lt;----------"<br> echo "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34mSetting UP variables \033[0m &lt;-"</p></div><p class="howto"><strong>Titre affiché à l’écran </strong></p><div class="thecode">LOOSE_UDP_PATCH=1</div><p class="howto"><strong>Correspond à un patch spécifique pour jouer avec des jeux communicants en UDP</strong></p><div class="thecode">MODEM_IP="<strong><em>[remplacer par l’IP ADSL]</em></strong>«&nbsp;<br> FIREWALL_LOG=/var/log/firewall<br> LOOSE_UDP_PATCH=1<br> LAN_BCAST_ADDRESS=&nbsp;»192.168.0.255/32″<br> INET_IFACE=&nbsp;»eth0″<br> LAN_IFACE=&nbsp;»eth1″<br> IPTABLES=&nbsp;»/sbin/iptables&nbsp;»<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>if [ "$FIREWALL_LOG" == "" ]; then FIREWALL_LOG=&nbsp;»/dev/null&nbsp;»; fi<br> echo «&nbsp;$date — Starting Firewall –&nbsp;» &gt;&gt; $FIREWALL_LOG</p><p>KERNELMAJ=`uname -r | sed -e ‘s,\..*,,’`<br> KERNELMIN=`uname -r | sed -e ‘s,[^\.]*\.,,’ -e ‘s,\..*,,’`<br> if [ "$KERNELMAJ" -lt 2 ] || [ "$KERNELMAJ" -eq 2 -a "$KERNELMIN" -lt 3 ]; then<br> echo -e «&nbsp;\033[40m\033[1;31mWARNING: Your kernel version is older than 2.4!\033[0m"<br> echo -e "\033[40m\033[1;31mYour kernel probably doesn't support IPTABLES unless an IPTABLES patch is compiled in it.\033[0m"<br> fi</p></div><p class="howto">On récupère la version du noyau et si il n’est pas au moins en 2.4, un warning est généré.</p><div class="thecode">echo -e "-&gt; \033[40m\033[1;31mSetting UP Banned IP variable \033[0m &lt;-"<br> BANNED_IP="12.13.14.15/24 15.16.17.18/28 19.20.21.22"</div><p class="howto"><strong>Certaines
 IP (centrales de publicité, machines de pirates ou piratées, organismes
 indésirables et autres…) sont à rentrer dans cette variable. Si vous ne
 souhaitez pas avoir de communication IP avec par exemple 
atdoubleclick.net, rentrez leur IP dans cette variable et toute 
communication entrante ou sortante sera bloquée.</strong></p><div class="thecode">echo -e "-&gt; \033[40m\033[1;31mSetting UP Reserved IP variable \033[0m &lt;-"<br> RESERVED_NET="0.0.0.0/8 1.0.0.0/8 2.0.0.0/8 3.0.0.0/8 4.0.0.0/8 5.0.0.0/8 7.0.0.0/8 10.0.0.0/8 14.0.0.0/8<br> 23.0.0.0/8 27.0.0.0/8 31.0.0.0/8 36.0.0.0/8 37.0.0.0/8 39.0.0.0/8 41.0.0.0/8 42.0.0.0/8 58.0.0.0/8 59.0.0.0/8<br> 60.0.0.0/8 70.0.0.0/8 71.0.0.0/8 72.0.0.0/8 73.0.0.0/8 74.0.0.0/8 75.0.0.0/8 76.0.0.0/8 77.0.0.0/8 78.0.0.0/8<br> 79.0.0.0/8 83.0.0.0/8 84.0.0.0/8 85.0.0.0/8 86.0.0.0/8 87.0.0.0/8 88.0.0.0/8 89.0.0.0/8 90.0.0.0/8 91.0.0.0/8<br> 92.0.0.0/8 93.0.0.0/8 94.0.0.0/8 95.0.0.0/8 96.0.0.0/8 97.0.0.0/8 98.0.0.0/8 99.0.0.0/8 100.0.0.0/8 101.0.0.0/8<br> 102.0.0.0/8 103.0.0.0/8 104.0.0.0/8 105.0.0.0/8 106.0.0.0/8 107.0.0.0/8 108.0.0.0/8 109.0.0.0/8 110.0.0.0/8<br> 111.0.0.0/8 112.0.0.0/8 113.0.0.0/8 114.0.0.0/8 115.0.0.0/8 116.0.0.0/8 117.0.0.0/8 118.0.0.0/8 119.0.0.0/8<br> 120.0.0.0/8 121.0.0.0/8 122.0.0.0/8 123.0.0.0/8 124.0.0.0/8 125.0.0.0/8 126.0.0.0/8 197.0.0.0/8 222.0.0.0/8<br> 223.0.0.0/8 224.0.0.0/8 225.0.0.0/8 226.0.0.0/8 227.0.0.0/8 228.0.0.0/8 229.0.0.0/8 230.0.0.0/8 231.0.0.0/8<br> 232.0.0.0/8 233.0.0.0/8 234.0.0.0/8 235.0.0.0/8 236.0.0.0/8 237.0.0.0/8 238.0.0.0/8 239.0.0.0/8 240.0.0.0/8<br> 241.0.0.0/8 242.0.0.0/8 243.0.0.0/8 244.0.0.0/8 245.0.0.0/8 246.0.0.0/8 247.0.0.0/8 248.0.0.0/8 249.0.0.0/8<br> 250.0.0.0/8 251.0.0.0/8 252.0.0.0/8 253.0.0.0/8 254.0.0.0/8 255.0.0.0/8 169.254.0.0/16 172.16.0.0/12 173.0.0.0/8<br> 174.0.0.0/8 175.0.0.0/8 176.0.0.0/8 177.0.0.0/8 178.0.0.0/8 179.0.0.0/8 180.0.0.0/8 181.0.0.0/8 182.0.0.0/8<br> 183.0.0.0/8 184.0.0.0/8 185.0.0.0/8 186.0.0.0/8 187.0.0.0/8 189.0.0.0/8 190.0.0.0/8"</div><p class="howto"><strong>Ces
 IP sont réservées, personne n’a à vous contacter avec. Il est donc 
recommandé de les interdire en entrée sur l’interface réseau connectée à
 Internet.</strong></p><div class="thecode">echo -e "-&gt; \033[40m\033[1;31mSetting Default Policies to DROP \033[0m &lt;-"<br> $IPTABLES -P INPUT DROP<br> $IPTABLES -P OUTPUT DROP<br> $IPTABLES -P FORWARD DROP</div><p class="howto"><strong>Par
 défaut on ‘drop’ (on dégage) tout. Après on accepte. Donc si un paquet 
arrive et qu’aucune autre règle ne l’autorise à passer, il est ‘dropé’.</strong></p><div class="thecode">echo -e "-&gt; \033[40m\033[1;33mFlushing all rules &amp; tables \033[0m &lt;-"<br> $IPTABLES -F<br> $IPTABLES -X<br> $IPTABLES -Z<br> $IPTABLES -F INPUT<br> $IPTABLES -F OUTPUT<br> $IPTABLES -F FORWARD<br> $IPTABLES -t nat -F<br> $IPTABLES -t nat -Z<br> $IPTABLES -t nat -X<br> $IPTABLES -t mangle -Z<br> $IPTABLES -t mangle -F<br> $IPTABLES -t mangle –X</div><p class="howto"><strong>On vide les tables et filtres de Netfilter pour partir d’un système vierge.</strong></p><div class="thecode">$IPTABLES -N LOG_DROP<br> $IPTABLES -A LOG_DROP -m limit --limit 6/h --limit-burst 1 -j LOG --log-tcp-options --log-prefix 'Drop Res/Ban address: '<br> #--log-ip-options --log-level local7<br> $IPTABLES -A LOG_DROP -j DROP</div><p class="howto"><strong>On
 crée une règle Log &amp; Drop. Cette règle permet de dégager un paquet 
et au passage de noter dans les logs que celui-ci a été refusé, le tout 
avec une seule ‘commande’.</strong></p><div class="thecode">echo -e "-&gt; \033[40m\033[1;34m Set kernel networking tweaks \033[0m &lt;-"<br> echo "0" &gt; /proc/sys/net/ipv4/ip_forward<br> echo "1" &gt; /proc/sys/net/ipv4/ip_dynaddr<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_source_route<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/rp_filter<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_timestamps<br> #echo "1" &gt; /proc/sys/net/ipv4/tcp_syncookies<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects<br> echo "2" &gt; /proc/sys/net/ipv4/conf/all/rp_filter<br> echo "1" &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses<br> echo "8192" &gt; /proc/sys/net/ipv4/ip_conntrack_max<br> echo "1" &gt; /proc/sys/net/ipv4/conf/all/log_martians<br> echo "30" &gt; /proc/sys/net/ipv4/tcp_fin_timeout<br> echo "2400" &gt; /proc/sys/net/ipv4/tcp_keepalive_time<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects<br> echo "0" &gt; /proc/sys/kernel/printk<br> echo -e "-&gt; \033[40m\033[1;34m Enabling reduction of the DoS'ing ability \033[0m &lt;-"<br> echo "10" &gt; /proc/sys/net/ipv4/tcp_fin_timeout<br> echo "1800" &gt; /proc/sys/net/ipv4/tcp_keepalive_time<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_window_scaling<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_sack<br> echo "64" &gt; /proc/sys/net/ipv4/ip_default_ttl<br> echo "2048" &gt; /proc/sys/net/ipv4/ip_queue_maxlen<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>if [ -e /proc/sys/net/ipv4/ip_masq_udp_dloose ]; then<br> if [ "$LOOSE_UDP_PATCH" == "1" ]; then<br> echo -e «&nbsp;-&gt; \033[40m\033[1;31mEnabling the LOOSE_UDP_PATCH (for some games, less secure!) \033[0m &lt;-"<br> echo "1" &gt; /proc/sys/net/ipv4/ip_masq_udp_dloose<br> else<br> echo -e "-&gt; \033[40m\033[1;34m Disabling the LOOSE_UDP_PATCH (more secure) \033[0m &lt;-"<br> echo "0" &gt; /proc/sys/net/ipv4/ip_masq_udp_dloose<br> fi<br> fi<br> #if [ -e /proc/sys/net/ipv4/ip_local_port_range ]; then<br> #echo «&nbsp;32768 61000″ &gt; /proc/sys/net/ipv4/ip_local_port_range<br> #fi<br> if [ -e /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses ]; then<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses<br> fi<br> if [ -e /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts ]; then<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts<br> fi<br> echo «&nbsp;0″ &gt; /proc/sys/net/ipv4/conf/eth0/accept_source_route<br> echo «&nbsp;0″ &gt; /proc/sys/net/ipv4/conf/eth0/send_redirects<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter<br> echo 0 &gt; /proc/sys/net/ipv4/tcp_window_scaling<br> echo 0 &gt; /proc/sys/net/ipv4/tcp_sack</p><p>if [ -e /proc/sys/net/ipv4/tcp_ecn ]; then<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34mEnabling ECN (Explicit Congestion Notification) \033[0m &lt;-"<br> echo "1" &gt; /proc/sys/net/ipv4/tcp_ecn<br> fi</p></div><p class="howto"><strong>Bon,
 on ne la fait pas en détail, ca serait un peu long. Disons que ces 
paramètres devraient convenir à la grande majorité des cas. Ces 
paramètres servent à configurer le comportement de la stack IP gérée par
 le noyau. La pile (stack en anglais) IP est l’endroit où se traitent 
les communications réseau pour faire simple. Le répertoire /proc dans la
 racine de votre linux vous permet d’altérer directement le comportement
 du noyau et un certain nombre de paramètre touchant au réseau. </strong></p><div class="thecode">echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;33m Logging some stuffs \033[0m &lt;-"<br> echo -e "-&gt; &lt;-"<br> $IPTABLES -A INPUT -i $INET_IFACE -s 192.168.0.0/24 -m limit --limit 3/m -j LOG --log-prefix "Spoofed packet: "<br> $IPTABLES -A INPUT -f -m limit --limit 3/m --limit-burst 1 -j LOG --log-prefix "Frag packet: "<br> $IPTABLES -A INPUT -s 10.0.0.0/8 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class A address: "<br> $IPTABLES -A INPUT -s 172.16.0.0/12 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class B address: "<br>
 #$IPTABLES -A INPUT -i $INET_IFACE -s 192.168.0.0/16 -m limit --limit 
60/h --limit-burst 1 -j LOG --log-prefix "Class C address: "<br> $IPTABLES -A INPUT -s 169.254.0.0/16 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class M$ address: "<br> $IPTABLES -A INPUT -i $INET_IFACE -p icmp -m limit --limit 12/hour --limit-burst 1 -j LOG --log-prefix "ICMP flood: "<br>
 #$IPTABLES -A INPUT -i ! $INET_IFACE -s "$MODEM_SUBNET/24" -m limit 
--limit 3/m -j LOG --log-level $LOGLEVEL --log-prefix "Spoofed (MODEM) 
packet: "<br> #$IPTABLES -A INPUT -i $INET_IFACE -m limit --limit 6/h -j LOG --log-prefix "Drop Spoofed MODEM packet:"<br>
 #$IPTABLES -A INPUT -i $INET_IFACE -m limit --limit 6/h -j LOG 
--log-tcp-options --log-ip-options --log-prefix '[IPTABLES DROP] : ‘<br>
 $IPTABLES -A INPUT -p tcp –dport 22 -m state –state NEW -m limit –limit
 3/m –limit-burst 2 -j LOG –log-prefix «&nbsp;Watched INPUT packet: 
«&nbsp;<br> #$IPTABLES -A INPUT -m limit –limit 6/h -j LOG –log-prefix «&nbsp;Dropped INPUT packet: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN,URG,PSH -m limit –limit 
3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS scan: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp –tcp-flags ALL SYN,RST,ACK,FIN,URG -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS-PSH 
scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL ALL -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS-ALL 
scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth FIN scan: 
«&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,RST SYN,RST -m 
limit –limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth 
SYN/RST scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,FIN 
SYN,FIN -m limit –limit 3/m –limit-burst 5 -j LOG –log-prefix 
«&nbsp;Stealth SYN/FIN scan(?): «&nbsp;<br> $IPTABLES -A INPUT -p tcp 
–tcp-flags ALL NONE -m limit –limit 3/m –limit-burst 5 -j LOG 
–log-prefix «&nbsp;Stealth Null scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –dport 0 -m limit –limit 6/h –limit-burst 1 -j LOG –log-prefix «&nbsp;Port 0 OS fingerprint: «&nbsp;<br>
 $IPTABLES -A INPUT -p udp –dport 0 -m limit –limit 6/h –limit-burst 1 
-j LOG –log-prefix «&nbsp;UDP port 0 OS fingerprint: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –sport 0 -m limit –limit 6/h –limit-burst 5 -j LOG –log-prefix «&nbsp;TCP source port 0: «&nbsp;<br> $IPTABLES -A INPUT -p udp –sport 0 -m limit –limit 6/h –limit-burst 5 -j LOG –log-prefix «&nbsp;UDP source port 0: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp -m multiport –sports 
20,21,22,23,80,110,143,443,993,995 -m limit –limit 6/h –limit-burst 1 -j
 LOG –log-prefix «&nbsp;Possible DRDOS attempt: «&nbsp;<br> $IPTABLES -A FORWARD -f -o $LAN_IFACE -m limit –limit 3/m -j LOG –log-prefix «&nbsp;FRAGMENTED PACKET (FWD): «&nbsp;<br> $IPTABLES -A FORWARD -i $INET_IFACE -s 192.168.0.0/24 -m limit –limit 3/m -j LOG –log-prefix «&nbsp;Spoofed packet: «&nbsp;<br>
 $IPTABLES -A OUTPUT -o $INET_IFACE -p tcp -m limit –limit 6/h 
–limit-burst 1 -j LOG –log-prefix «&nbsp;Watched OUTPUT packet: «&nbsp;<br>
 $IPTABLES -A OUTPUT -p tcp –dport 22 -m state –state NEW -m limit 
–limit 3/m –limit-burst 2 -j LOG –log-prefix «&nbsp;Watched OUTPUT 
packet: «&nbsp;</div><p class="howto"><strong>Voici quelques exemples de
 logs. On log des évènements, juste l’histoire de savoir ce qui se passe
 sur notre réseau. Je vous déconseille de tout ‘logger’… Ca devient très
 vite énorme en fait et trop d’information tue l’information. Donc ne 
loggez que ce qui est utile potentiellement. Certaines règles sont 
assorties d’un ‘-m limit –limit n/h –limit burst’. Cela permet de 
limiter la quantité de message à n par heure. (on peut se servir de 
limit dans d’autre cas, pas juste pour logger. Par exemple on peut 
limiter les pings à 3/heure pas plus)</strong></p><p class="howto"><strong>Attention&nbsp;!
 Ce ne sont que des règles de log (-j LOG), ce n’est pas ici que l’on 
drop les paquets. Ici on note leur passage c’est tout, donc il faut 
mettre en cohérence les règles plus loin dans le script. Si l’on drop 
les paquets fragmentés par exemple, la règle log ne suffit pas il faut 
ajouter une règle DROP après dans le script, ou tout faire en une fois 
avec une règle –j LOG_DROP.</strong></p><div class="thecode">echo -e «&nbsp;-&gt; \033[40m\033[1;32m PreRouting rules \033[0m &lt;-"<br>
 $IPTABLES -A PREROUTING -t nat -p tcp -i $INET_IFACE -s xx.xxx.xx.xxx 
-d yy.yy.yyy.yyy --dport 8192 -j DNAT --to 192.168.0.2:8192<br> 
$IPTABLES -A PREROUTING -t nat -p tcp -i $INET_IFACE -s xx.xxx.xx.xxx -d
 yy.yy.yyy.yyy --dport 3389 -j DNAT --to 192.168.0.2:3389</div><p class="howto"><strong>Ceci
 est un cas de ‘port forwarding’. Le filtre prerouting sert à traiter 
les paquets au moment de leur arrivée sur l’interface réseau pour leur 
appliquer un traitement spécial de redirection. </strong></p><p class="howto"><strong>Les
 deux règles mises en exemple sont faites pour me permettre de prendre 
le contrôle de ma machine personnelle à la maison depuis mon bureau. 
Tout ce qui arrive sur le port 8192 depuis l’addresse xx.xxx.xx.xxx est 
redirigé vers mon réseau local sur l’ip yy.yy.yyy.yyy sur le port 8192. 
(La seconde est faite sur le même principe mais pour prendre le contrôle
 en remote desktop (terminal server) plutôt qu’en VNC) </strong></p><div class="thecode">echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;33m Enabling \033[0m &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34m Generic protection Rules \033[0m &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34m AntiSpoofing Rule \033[0m &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34m SYN-Flooding Protection \033[0m &lt;-"<br> #echo -e "-&gt; \033[40m\033[1;34m Drop Fragmented packets \033[0m &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34m Anti Loopback spoofing \033[0m &lt;-"<br> echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;32m INPUT RULING (accept) \033[0m &lt;-"</div><p class="howto"><strong>Plein
 de commentaires visuels pour dire ce que l’on active plus loin dans le 
scripte. Vu que j’ai regroupé les règles en Input / Forward / Output, il
 est difficile de mettre tous les commentaires ligne par ligne aux bons 
endroits.</strong></p><div class="thecode">$IPTABLES -A INPUT -p all -m state --state ESTABLISHED,RELATED -j ACCEPT<br> #$IPTABLES -A INPUT -i $INET_IFACE -s "$MODEM_IF" -d "$MODEM_IF_IP" -j ACCEPT<br> $IPTABLES -A INPUT -i $INET_IFACE -s 14.15.16.21 -j ACCEPT<br> $IPTABLES -I INPUT -p TCP -s 192.168.0.2 -d 192.168.0.254 --dport 80 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 14.15.16.18/32 --dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -s 0.0.0.0/0 --dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -i eth0 -s 212.27.32.5 -d 22.23.24.144 --sport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 14.15.16.21/32 --dport 22 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -i $LAN_IFACE -s 192.168.0.2/32 --dport 22 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -s 0.0.0.0/0 --dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 0.0.0.0/0 --dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p ICMP -s 192.134.4.20/32 -j ACCEPT # AFNIC Zonecheck Fix<br> $IPTABLES -A INPUT -p ICMP -s 14.15.16.18/29 -j ACCEPT # Ping from NBS Network<br> $IPTABLES-A INPUT -p ICMP -s 192.168.0.0/24 -j ACCEPT # Ping from LAN<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>echo -e "-&gt; \033[40m\033[1;32mBroadcast and loopback INPUT RULING (accept) \033[0m &lt;-"<br> $IPTABLES -A INPUT -i $INET_IFACE -d 255.255.255.255 -p udp --sport 67 --dport 68 -j ACCEPT<br> $IPTABLES -A INPUT -p ICMP -i lo -j ACCEPT<br> $IPTABLES -A INPUT -i eth1 -p ALL -d $LAN_BCAST_ADDRESS -j ACCEPT<br> $IPTABLES -A INPUT -i lo -s 127.0.0.1 -j ACCEPT</p><p>echo -e "-&gt; \033[40m\033[1;31mINPUT RULING (drop) \033[0m &lt;-"<br> #$IPTABLES -A INPUT -f -j DROP # drop fragemented packet<br> $IPTABLES -A INPUT -m state --state INVALID -j DROP # drop invalid paclet<br> $IPTABLES -A INPUT -i $INET_IFACE -p tcp ! --syn -m state --state NEW -j DROP #drop connexion wich doesn't start by a syn<br> $IPTABLES -A INPUT -p tcp --tcp-option 64 -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-option 128 -j DROP<br> #$IPTABLES -A INPUT -i ! $INET_IFACE -s "$MODEM_IP" -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 127.0.0.0/8 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 192.168.0.255 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 255.255.255.255 -j DROP</p><p>echo -e "-&gt; \033[40m\033[1;34mANTI SCAN (drop) \033[0m &lt;-"<br> $IPTABLES -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags ALL ALL -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags ALL FIN -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP<br> $IPTABLES -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</p><p>echo -e "-&gt; \033[40m\033[1;34m NAPTA/SYN FLOOD SMURFING/DRDoSing Protection \033[0m &lt;-"<br> $IPTABLES -A INPUT -p tcp -m multiport --sports 20,21,22,23,80,110,143,443,993,995 -j DROP<br> $IPTABLES -A INPUT -p tcp --sport 0 -j DROP<br> $IPTABLES -A INPUT -p udp --sport 0 -j DROP<br> $IPTABLES -A INPUT -p tcp --dport 0 -j DROP<br> $IPTABLES -A INPUT -p udp --dport 0 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -s 192.168.0.0/24 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -j DROP<br> $IPTABLES -N syn-flood<br> $IPTABLES -A INPUT -i $INET_IFACE -p tcp --syn -j syn-flood<br> $IPTABLES -A syn-flood -m limit --limit 1/s --limit-burst 4 -j RETURN<br> $IPTABLES -A syn-flood -j DROP</p></div><p class="howto"><strong>Les règles de communication vers le firewall </strong></p><div class="thecode">echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;32m FORWARD RULING (accept) \033[0m &lt;-"<br> $IPTABLES -A FORWARD -i eth1 -o eth0 -p all -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p udp -i $INET_IFACE --dport 500 -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p tcp -i $INET_IFACE --dport 1723 -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p tcp -i $INET_IFACE --dport 3389 -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p udp -i $INET_IFACE --dport 4500 -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p tcp -i $INET_IFACE --dport 8192 -j ACCEPT<br> $IPTABLES -A FORWARD -p TCP -s 0.0.0.0/0 -i $INET_IFACE --dport 4411 -j ACCEPT<br> $IPTABLES -A FORWARD -p TCP -s 0.0.0.0/0 -i $INET_IFACE --dport 5701 -j ACCEPT<br> $IPTABLES -A FORWARD -p TCP -s 0.0.0.0/0 -i $INET_IFACE --dport 5702 -j ACCEPT<br> $IPTABLES -A FORWARD -p UDP -s 0.0.0.0/0 -i $INET_IFACE --dport 5703 -j ACCEPT<br> $IPTABLES -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu<br> $IPTABLES -A FORWARD -i eth1 -o eth0 -j ACCEPT<br> $IPTABLES -A FORWARD -i $INET_IFACE -o $LAN_IFACE -p all -m state --state ESTABLISHED,RELATED -j ACCEPT<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>echo -e "-&gt; \033[40m\033[1;31mFORWARD RULING (drop) \033[0m &lt;-"<br> $IPTABLES -A FORWARD -m state --state INVALID -j DROP<br> #$IPTABLES -A FORWARD -i ! $INET_IFACE -s "$MODEM_IF_IP/24" -j DROP<br> $IPTABLES -A FORWARD -i $INET_IFACE -s 192.168.0.0/24 -j DROP<br> $IPTABLES -A FORWARD -p tcp --dport 135:139 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -p udp --dport 135:139 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -p tcp --dport 445 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -i $INET_IFACE -o $LAN_IFACE -j DROP</p></div><p class="howto"><strong>Les règles de communication à travers le firewall </strong></p><div class="thecode">echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;32m OUTPUT RULING (accept) \033[0m &lt;-"<br> $IPTABLES -A OUTPUT -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu<br> $IPTABLES -A OUTPUT -p all -m state --state ESTABLISHED,RELATED -j ACCEPT<br> $IPTABLES -A OUTPUT -p ICMP -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP --dport 20 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP --dport 21 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP --dport 22 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP --dport 25 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP --dport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP --dport 123 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP --dport 123 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -s 22.23.24.144 -d 0.0.0.0/0 --sport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -s 22.23.24.144 -d 14.15.16.18 --dport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -o $INET_IFACE --sport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -d 0/0 --dport 80 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -d 0/0 --dport 443 -j ACCEPT<br> $IPTABLES -A OUTPUT -p tcp -d 192.168.0.2 --dport 6000 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -s 22.23.24.144 --sport 53 -j ACCEPT<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>echo -e "-&gt; \033[40m\033[1;31mOUTPUT RULING (drop) \033[0m &lt;-"<br> $IPTABLES -A OUTPUT -p tcp -d 0/0 --sport 135:139 -j DROP<br> $IPTABLES -A OUTPUT -p udp -d 0/0 --sport 135:139 -j DROP<br> $IPTABLES -A OUTPUT -p udp -d 0/0 --sport 445 -j DROP<br> #$IPTABLES -A OUTPUT -p all -d 0/0 -j DROP</p></div><p class="howto"><strong>Les règles de communication depuis le firewall </strong></p><div class="thecode">echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;33m ADSL connexion clamping &amp; Masquerading \033[0m &lt;-"<br> $IPTABLES -t nat -A POSTROUTING -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu<br> $IPTABLES -t nat -A POSTROUTING -o $INET_IFACE -j MASQUERADE</div><p class="howto"><strong>Les règles pour masquerader le LAN et lui permettre de surfer </strong></p><div class="thecode">echo "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;31mBANNING INPUT &amp; FORWARD FOR RESERVED &amp; EVIL IPs \033[0m &lt;-"<br> for net in $RESERVED_NET; do<br> $IPTABLES -A INPUT -i $INET_IFACE -s $net -j LOG_DROP<br> $IPTABLES -A FORWARD -i $INET_IFACE -s $net -j LOG_DROP<br> done<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>#for banned in $BANNED_IP; do<br> #$IPTABLES -A INPUT -i $INET_IFACE -s $banned -m limit --limit 6/h --limit-burst 1 -j LOG --log-prefix "Banned IP: "<br> #$IPTABLES -A INPUT -i $INET_IFACE -s $banned -j DROP<br>
 #$IPTABLES -A FORWARD -i $INET_IFACE -s $banned -m limit --limit 6/h 
--limit-burst 1 -j LOG --log-prefix "Drop fwd of Banned IP: "<br> #$IPTABLES -A FORWARD -i $INET_IFACE -s $banned -j DROP<br> #done</p></div><p class="howto"><strong>Deux petites boucles pour dégager les ip bannies et les réservées</strong></p><div class="thecode">echo -e "-&gt; \033[40m\033[1;32m Activating Forward \033[0m &lt;-"<br> echo 1 &gt; /proc/sys/net/ipv4/ip_forward</div><p class="howto"><strong>On est protégés, on peut activer le forward entre les interfaces réseau </strong></p><div class="thecode">echo "-&gt; &lt;-"<br> echo -e "------------------------&gt; \033[40m\033[1;32mEOF : End of Firewall \033[0m&lt;-----------------------"<br> echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;32m Spawning log console to $DISPLAY \033[0m&lt;-"<br> echo -e "-&gt; &lt;-"<br> echo -e "------------------------&gt;\033[40m\033[1;32m ALL DONE ! \033[0m&lt;------------------------"<br> echo " "<br> ;;</div><p class="howto"><strong>Pour stopper le firewall. </strong></p><div class="thecode">stop)<br> echo -e "\033[40m\033[1;31m----------------------&gt; Shutting down Firewall ! &lt;----------------------\033[0m"<br> echo " "<br> IPTABLES="/sbin/iptables"<br> $IPTABLES -F<br> $IPTABLES -X<br> $IPTABLES -Z<br> $IPTABLES -F INPUT<br> $IPTABLES -F OUTPUT<br> $IPTABLES -F FORWARD<br> $IPTABLES -t nat -F<br> $IPTABLES -t nat -Z<br> $IPTABLES -t nat -X<br> #$IPTABLES -t mangle -Z<br> #$IPTABLES -t mangle -F<br> #$IPTABLES -t mangle -X<br> echo 0 &gt; /proc/sys/net/ipv4/ip_forward<br> echo " "<br> echo "-&gt; DONE ! &lt;-"<br> ;;<br> *)<br> echo "Usage: /etc/init.d/firewall {start|stop}"<br> exit 1<br> ;;<br> esac<br> exit 0</div><p class="howto"><strong>Le script de Firewalling iptables propre en un bloc (à adapter un peu quand même) stocker le dans /etc/init.d/firewall </strong></p><div class="thecode">#!/bin/sh<p></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p><br class="spacer_"></p><p>case "$1" in<br> start)</p><p>date=`date +'%b %d %k:%M:%S'`;<br> echo " "<br> echo -e "-----------&gt; \033[40m\033[1;32mADSL Firewalling Script V1.9\033[0m &lt;--------------"<br> echo -e "---------&gt; \033[40m\033[1;32mLast Updated on 02/01/2005\033[0m &lt;----------"<br> echo -e "---------&gt; \033[40m\033[1;33mStarting on $date \033[0m &lt;----------"<br> echo "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;34mSetting UP variables \033[0m &lt;-"<br> LOOSE_UDP_PATCH=1<br> MODEM_IP="`route -n | grep "0.0.0.0" | grep "UG" | awk '{print $2}'`" #<strong><em>[ou remplacer directement par l’IP ADSL de la machine] </em></strong><br> FIREWALL_LOG=/var/log/firewall<br> LOOSE_UDP_PATCH=1<br> LAN_BCAST_ADDRESS=&nbsp;»192.168.0.255/32″<br> INET_IFACE=&nbsp;»eth0″ #<strong><em>[remplacer par la bonne interface Internet ou ppp0 si besoin]</em></strong><br> LAN_IFACE=&nbsp;»eth1″ #<strong><em>[remplacer par l’interface du LAN]</em></strong><br> IPTABLES=&nbsp;»/sbin/iptables&nbsp;»<br> TRUSTED_IP=&nbsp;»0.0.0.0 &nbsp;» <strong>#remplacer par une IP de confiance</strong><br> MYLAN_IP=&nbsp;»0.0.0.0″ <strong>#remplacer par une IP d ans le lan nécessitant un DNAT/SNAT (prise de contrôle VNC par exemple) </strong><br> FIREWALL_IP=&nbsp;»192.168.0.254″ <strong>#remplacer par l’IP du firewall dans le LAN</strong><br> LANNET=&nbsp;»192.168.0.0/24″ <strong>#votre réseau et masque de sous réseau du LAN </strong></p><p>if [ "$FIREWALL_LOG" == "" ]; then FIREWALL_LOG=&nbsp;»/dev/null&nbsp;»; fi<br> echo «&nbsp;$date — Starting Firewall –&nbsp;» &gt;&gt; $FIREWALL_LOG KERNELMAJ=`uname -r | sed -e ‘s,\..*,,’`</p><p>KERNELMIN=`uname -r | sed -e ‘s,[^\.]*\.,,’ -e ‘s,\..*,,’`<br> if [ "$KERNELMAJ" -lt 2 ] || [ "$KERNELMAJ" -eq 2 -a "$KERNELMIN" -lt 3 ]; then<br> echo -e «&nbsp;\033[40m\033[1;31mWARNING: Your kernel version is older than 2.4!\033[0m"<br> echo -e "\033[40m\033[1;31mYour kernel probably doesn't support IPTABLES unless an IPTABLES patch is compiled in it.\033[0m"<br> fi</p><p>echo -e "-&gt; \033[40m\033[1;31mSetting UP Banned IP variable \033[0m &lt;-"<br> BANNED_IP="12.13.14.15/24 15.16.17.18/28 19.20.21.22"</p><p>echo -e "-&gt; \033[40m\033[1;31mSetting UP Reserved IP variable \033[0m &lt;-"<br> RESERVED_NET="0.0.0.0/8 1.0.0.0/8 2.0.0.0/8 3.0.0.0/8 4.0.0.0/8 5.0.0.0/8 7.0.0.0/8 10.0.0.0/8 14.0.0.0/8<br> 23.0.0.0/8 27.0.0.0/8 31.0.0.0/8 36.0.0.0/8 37.0.0.0/8 39.0.0.0/8 41.0.0.0/8 42.0.0.0/8 58.0.0.0/8 59.0.0.0/8<br> 60.0.0.0/8 70.0.0.0/8 71.0.0.0/8 72.0.0.0/8 73.0.0.0/8 74.0.0.0/8 75.0.0.0/8 76.0.0.0/8 77.0.0.0/8 78.0.0.0/8<br> 79.0.0.0/8 83.0.0.0/8 84.0.0.0/8 85.0.0.0/8 86.0.0.0/8 87.0.0.0/8 88.0.0.0/8 89.0.0.0/8 90.0.0.0/8 91.0.0.0/8<br> 92.0.0.0/8 93.0.0.0/8 94.0.0.0/8 95.0.0.0/8 96.0.0.0/8 97.0.0.0/8 98.0.0.0/8 99.0.0.0/8 100.0.0.0/8 101.0.0.0/8<br> 102.0.0.0/8 103.0.0.0/8 104.0.0.0/8 105.0.0.0/8 106.0.0.0/8 107.0.0.0/8 108.0.0.0/8 109.0.0.0/8 110.0.0.0/8<br> 111.0.0.0/8 112.0.0.0/8 113.0.0.0/8 114.0.0.0/8 115.0.0.0/8 116.0.0.0/8 117.0.0.0/8 118.0.0.0/8 119.0.0.0/8<br> 120.0.0.0/8 121.0.0.0/8 122.0.0.0/8 123.0.0.0/8 124.0.0.0/8 125.0.0.0/8 126.0.0.0/8 197.0.0.0/8 222.0.0.0/8<br> 223.0.0.0/8 224.0.0.0/8 225.0.0.0/8 226.0.0.0/8 227.0.0.0/8 228.0.0.0/8 229.0.0.0/8 230.0.0.0/8 231.0.0.0/8<br> 232.0.0.0/8 233.0.0.0/8 234.0.0.0/8 235.0.0.0/8 236.0.0.0/8 237.0.0.0/8 238.0.0.0/8 239.0.0.0/8 240.0.0.0/8<br> 241.0.0.0/8 242.0.0.0/8 243.0.0.0/8 244.0.0.0/8 245.0.0.0/8 246.0.0.0/8 247.0.0.0/8 248.0.0.0/8 249.0.0.0/8<br> 250.0.0.0/8 251.0.0.0/8 252.0.0.0/8 253.0.0.0/8 254.0.0.0/8 255.0.0.0/8 169.254.0.0/16 172.16.0.0/12 173.0.0.0/8<br> 174.0.0.0/8 175.0.0.0/8 176.0.0.0/8 177.0.0.0/8 178.0.0.0/8 179.0.0.0/8 180.0.0.0/8 181.0.0.0/8 182.0.0.0/8<br> 183.0.0.0/8 184.0.0.0/8 185.0.0.0/8 186.0.0.0/8 187.0.0.0/8 189.0.0.0/8 190.0.0.0/8"</p><p>echo -e "-&gt; \033[40m\033[1;31mSetting Default Policies to DROP \033[0m &lt;-"<br> $IPTABLES -P INPUT DROP<br> $IPTABLES -P OUTPUT DROP<br> $IPTABLES -P FORWARD DROP</p><p>echo -e "-&gt; \033[40m\033[1;33mFlushing all rules &amp; tables \033[0m &lt;-"<br> $IPTABLES -F<br> $IPTABLES -X<br> $IPTABLES -Z<br> $IPTABLES -F INPUT<br> $IPTABLES -F OUTPUT<br> $IPTABLES -F FORWARD<br> $IPTABLES -t nat -F<br> $IPTABLES -t nat -Z<br> $IPTABLES -t nat -X<br> $IPTABLES -t mangle -Z<br> $IPTABLES -t mangle -F<br> $IPTABLES -t mangle –X</p><p>$IPTABLES -N LOG_DROP<br> $IPTABLES -A LOG_DROP -m limit --limit 6/h --limit-burst 1 -j LOG --log-tcp-options --log-prefix 'Drop Res/Ban address: '<br> $IPTABLES -A LOG_DROP -j DROP</p><p>echo -e "-&gt; \033[40m\033[1;34m Set kernel networking tweaks \033[0m &lt;-"<br> echo "0" &gt; /proc/sys/net/ipv4/ip_forward<br> echo "1" &gt; /proc/sys/net/ipv4/ip_dynaddr<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_source_route<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/rp_filter<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_timestamps<br> #echo "1" &gt; /proc/sys/net/ipv4/tcp_syncookies<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects<br> echo "2" &gt; /proc/sys/net/ipv4/conf/all/rp_filter<br> echo "1" &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses<br> echo "8192" &gt; /proc/sys/net/ipv4/ip_conntrack_max<br> echo "1" &gt; /proc/sys/net/ipv4/conf/all/log_martians<br> echo "30" &gt; /proc/sys/net/ipv4/tcp_fin_timeout<br> echo "2400" &gt; /proc/sys/net/ipv4/tcp_keepalive_time<br> echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects<br> echo "0" &gt; /proc/sys/kernel/printk</p><p>echo -e "-&gt; \033[40m\033[1;34m Enabling reduction of the DoS'ing ability \033[0m &lt;-"<br> echo "10" &gt; /proc/sys/net/ipv4/tcp_fin_timeout<br> echo "1800" &gt; /proc/sys/net/ipv4/tcp_keepalive_time<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_window_scaling<br> echo "0" &gt; /proc/sys/net/ipv4/tcp_sack<br> echo "64" &gt; /proc/sys/net/ipv4/ip_default_ttl<br> echo "2048" &gt; /proc/sys/net/ipv4/ip_queue_maxlen</p><p>if [ -e /proc/sys/net/ipv4/ip_masq_udp_dloose ]; then<br> if [ "$LOOSE_UDP_PATCH" == "1" ]; then<br> echo -e «&nbsp;-&gt; \033[40m\033[1;31mEnabling the LOOSE_UDP_PATCH (for some games, less secure!) \033[0m &lt;-"<br> echo "1" &gt; /proc/sys/net/ipv4/ip_masq_udp_dloose<br> else<br> echo -e "-&gt; \033[40m\033[1;34m Disabling the LOOSE_UDP_PATCH (more secure) \033[0m &lt;-"<br> echo "0" &gt; /proc/sys/net/ipv4/ip_masq_udp_dloose<br> fi<br> fi</p><p>#if [ -e /proc/sys/net/ipv4/ip_local_port_range ]; then<br> #echo «&nbsp;32768 61000″ &gt; /proc/sys/net/ipv4/ip_local_port_range<br> #fi</p><p>if [ -e /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses ]; then<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses<br> fi</p><p>if [ -e /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts ]; then<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts<br> fi</p><p>echo «&nbsp;0″ &gt; /proc/sys/net/ipv4/conf/eth0/accept_source_route<br> echo «&nbsp;0″ &gt; /proc/sys/net/ipv4/conf/eth0/send_redirects<br> echo «&nbsp;1″ &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter<br> echo 0 &gt; /proc/sys/net/ipv4/tcp_window_scaling<br> echo 0 &gt; /proc/sys/net/ipv4/tcp_sack</p><p>if [ -e /proc/sys/net/ipv4/tcp_ecn ]; then<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34mEnabling ECN (Explicit Congestion Notification) \033[0m &lt;-"<br> echo "1" &gt; /proc/sys/net/ipv4/tcp_ecn<br> fi</p><p>echo -e "-&gt; &lt;-"<br> echo -e "-&gt; \033[40m\033[1;33m Logging some stuffs \033[0m &lt;-"<br> echo -e "-&gt; &lt;-"<br> $IPTABLES -A INPUT -i $INET_IFACE -s $LANNET -m limit --limit 3/m -j LOG --log-prefix "Spoofed packet: "<br> $IPTABLES -A INPUT -f -m limit --limit 3/m --limit-burst 1 -j LOG --log-prefix "Frag packet: "<br> $IPTABLES -A INPUT -s 10.0.0.0/8 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class A address: "<br> $IPTABLES -A INPUT -s 172.16.0.0/12 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class B address: "<br> #$IPTABLES -A INPUT -i $INET_IFACE -s $LANNET -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class C address: "<br> $IPTABLES -A INPUT -s 169.254.0.0/16 -m limit --limit 60/h --limit-burst 1 -j LOG --log-prefix "Class M$ address: "<br> $IPTABLES -A INPUT -i $INET_IFACE -p icmp -m limit --limit 12/hour --limit-burst 1 -j LOG --log-prefix "ICMP flood: "<br>
 #$IPTABLES -A INPUT -i ! $INET_IFACE -s $MODEM_IP/24 -m limit --limit 
3/m -j LOG --log-level $LOGLEVEL --log-prefix "Spoofed (MODEM) packet: "<br> #$IPTABLES -A INPUT -i $INET_IFACE -m limit --limit 6/h -j LOG --log-prefix "Drop Spoofed MODEM packet:"<br>
 #$IPTABLES -A INPUT -i $INET_IFACE -m limit --limit 6/h -j LOG 
--log-tcp-options --log-ip-options --log-prefix '[IPTABLES DROP] : ‘<br>
 $IPTABLES -A INPUT -p tcp –dport 22 -m state –state NEW -m limit –limit
 3/m –limit-burst 2 -j LOG –log-prefix «&nbsp;Watched INPUT packet: 
«&nbsp;<br> #$IPTABLES -A INPUT -m limit –limit 6/h -j LOG –log-prefix «&nbsp;Dropped INPUT packet: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN,URG,PSH -m limit –limit 
3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS scan: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp –tcp-flags ALL SYN,RST,ACK,FIN,URG -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS-PSH 
scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL ALL -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth XMAS-ALL 
scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN -m limit 
–limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth FIN scan: 
«&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,RST SYN,RST -m 
limit –limit 3/m –limit-burst 5 -j LOG –log-prefix «&nbsp;Stealth 
SYN/RST scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,FIN 
SYN,FIN -m limit –limit 3/m –limit-burst 5 -j LOG –log-prefix 
«&nbsp;Stealth SYN/FIN scan(?): «&nbsp;<br> $IPTABLES -A INPUT -p tcp 
–tcp-flags ALL NONE -m limit –limit 3/m –limit-burst 5 -j LOG 
–log-prefix «&nbsp;Stealth Null scan: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –dport 0 -m limit –limit 6/h –limit-burst 1 -j LOG –log-prefix «&nbsp;Port 0 OS fingerprint: «&nbsp;<br>
 $IPTABLES -A INPUT -p udp –dport 0 -m limit –limit 6/h –limit-burst 1 
-j LOG –log-prefix «&nbsp;UDP port 0 OS fingerprint: «&nbsp;<br> $IPTABLES -A INPUT -p tcp –sport 0 -m limit –limit 6/h –limit-burst 5 -j LOG –log-prefix «&nbsp;TCP source port 0: «&nbsp;<br> $IPTABLES -A INPUT -p udp –sport 0 -m limit –limit 6/h –limit-burst 5 -j LOG –log-prefix «&nbsp;UDP source port 0: «&nbsp;<br>
 $IPTABLES -A INPUT -p tcp -m multiport –sports 
20,21,22,23,80,110,143,443,993,995 -m limit –limit 6/h –limit-burst 1 -j
 LOG –log-prefix «&nbsp;Possible DRDOS attempt: «&nbsp;<br> $IPTABLES -A FORWARD -f -o $LAN_IFACE -m limit –limit 3/m -j LOG –log-prefix «&nbsp;FRAGMENTED PACKET (FWD): «&nbsp;<br> $IPTABLES -A FORWARD -i $INET_IFACE -s $LANNET -m limit –limit 3/m -j LOG –log-prefix «&nbsp;Spoofed packet: «&nbsp;<br>
 $IPTABLES -A OUTPUT -o $INET_IFACE -p tcp -m limit –limit 6/h 
–limit-burst 1 -j LOG –log-prefix «&nbsp;Watched OUTPUT packet: «&nbsp;<br>
 $IPTABLES -A OUTPUT -p tcp –dport 22 -m state –state NEW -m limit 
–limit 3/m –limit-burst 2 -j LOG –log-prefix «&nbsp;Watched OUTPUT 
packet: «&nbsp;</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;32m PreRouting rules \033[0m &lt;-&nbsp;»<br> $IPTABLES -A PREROUTING -t nat -p tcp -i $INET_IFACE -s $ TRUSTED_IP -d $MODEM_IP –dport 5900 -j DNAT –to $MYLAN_IP:8192<br> $IPTABLES -A PREROUTING -t nat -p tcp -i $INET_IFACE -s $TRUSTED_IP -d $MODEM_IP –dport 3389 -j DNAT –to $MYLAN_IP:3389</p><p>echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;33m Enabling \033[0m &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34m Generic protection Rules \033[0m &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34m AntiSpoofing Rule \033[0m &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34m SYN-Flooding Protection \033[0m &lt;-&nbsp;»<br> #echo -e «&nbsp;-&gt; \033[40m\033[1;34m Drop Fragmented packets \033[0m &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;34m Anti Loopback spoofing \033[0m &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;32m INPUT RULING (accept) \033[0m &lt;-&nbsp;»</p><p>$IPTABLES -A INPUT -p all -m state –state ESTABLISHED,RELATED -j ACCEPT<br> #$IPTABLES -A INPUT -i $INET_IFACE -s «&nbsp;$MODEM_IF&nbsp;» -d «&nbsp;$MODEM_IF_IP&nbsp;» -j ACCEPT<br> $IPTABLES -A INPUT -i $INET_IFACE -s 14.15.16.21 -j ACCEPT<br> $IPTABLES -I INPUT -p TCP -s $MYLAN_IP -d $FIREWALL_IP –dport 80 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 14.15.16.18/32 –dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -s 0.0.0.0/0 –dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -i eth0 -s 212.27.32.5 -d 22.23.24.144 –sport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 14.15.16.21/32 –dport 22 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -i $LAN_IFACE -s 192.168.0.2/32 –dport 22 -j ACCEPT<br> $IPTABLES -A INPUT -p UDP -s 0.0.0.0/0 –dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p TCP -s 0.0.0.0/0 –dport 53 -j ACCEPT<br> $IPTABLES -A INPUT -p ICMP -s 192.134.4.20/32 -j ACCEPT # AFNIC Zonecheck Fix<br> $IPTABLES -A INPUT -p ICMP -s 14.15.16.18/29 -j ACCEPT # Ping from NBS Network<br> $IPTABLES -A INPUT -p ICMP -s $MYLAN -j ACCEPT # Ping from LAN</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;32mBroadcast and loopback INPUT RULING (accept) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A INPUT -i $INET_IFACE -d 255.255.255.255 -p udp –sport 67 –dport 68 -j ACCEPT<br> $IPTABLES -A INPUT -p ICMP -i lo -j ACCEPT<br> $IPTABLES -A INPUT -i eth1 -p ALL -d $LAN_BCAST_ADDRESS -j ACCEPT<br> $IPTABLES -A INPUT -i lo -s 127.0.0.1 -j ACCEPT</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;31mINPUT RULING (drop) \033[0m &lt;-&nbsp;»<br> #$IPTABLES -A INPUT -f -j DROP # drop fragemented packet<br> $IPTABLES -A INPUT -m state –state INVALID -j DROP # drop invalid paclet</p><p>$IPTABLES -A INPUT -i $INET_IFACE -p tcp ! –syn -m state –state NEW -j DROP #drop connexion wich doesn’t start by a syn<br> $IPTABLES -A INPUT -p tcp –tcp-option 64 -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-option 128 -j DROP<br> #$IPTABLES -A INPUT -i ! $INET_IFACE -s «&nbsp;$MODEM_IP&nbsp;» -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 127.0.0.0/8 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 192.168.0.255 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -d 255.255.255.255 -j DROP</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;34mANTI SCAN (drop) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN,URG,PSH -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL ALL -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL FIN -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,RST SYN,RST -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags SYN,FIN SYN,FIN -j DROP<br> $IPTABLES -A INPUT -p tcp –tcp-flags ALL NONE -j DROP</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;34m NAPTA/SYN FLOOD SMURFING/DRDoSing Protection \033[0m &lt;-&nbsp;»<br> $IPTABLES -A INPUT -p tcp -m multiport –sports 20,21,22,23,80,110,143,443,993,995 -j DROP<br> $IPTABLES -A INPUT -p tcp –sport 0 -j DROP<br> $IPTABLES -A INPUT -p udp –sport 0 -j DROP<br> $IPTABLES -A INPUT -p tcp –dport 0 -j DROP<br> $IPTABLES -A INPUT -p udp –dport 0 -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -s $LANNET -j DROP<br> $IPTABLES -A INPUT -i $INET_IFACE -j DROP<br> $IPTABLES -N syn-flood<br> $IPTABLES -A INPUT -i $INET_IFACE -p tcp –syn -j syn-flood<br> $IPTABLES -A syn-flood -m limit –limit 1/s –limit-burst 4 -j RETURN<br> $IPTABLES -A syn-flood -j DROP</p><p>echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;32m FORWARD RULING (accept) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A FORWARD -i eth1 -o eth0 -p all -m state –state NEW,ESTABLISHED,RELATED -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p tcp -i $INET_IFACE –dport 3389 -j ACCEPT<br> $IPTABLES -A FORWARD -s 14.15.16.21/32 -p tcp -i $INET_IFACE –dport 5900 -j ACCEPT<br> $IPTABLES -A FORWARD -p tcp –tcp-flags SYN,RST SYN -j TCPMSS –clamp-mss-to-pmtu<br> $IPTABLES -A FORWARD -i eth1 -o eth0 -j ACCEPT<br> $IPTABLES -A FORWARD -i $INET_IFACE -o $LAN_IFACE -p all -m state –state ESTABLISHED,RELATED -j ACCEPT</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;31mFORWARD RULING (drop) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A FORWARD -m state –state INVALID -j DROP<br> #$IPTABLES -A FORWARD -i ! $INET_IFACE -s «&nbsp;$MODEM_IF_IP/24″ -j DROP<br> $IPTABLES -A FORWARD -i $INET_IFACE -s 192.168.0.0/24 -j DROP<br> $IPTABLES -A FORWARD -p tcp –dport 135:139 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -p udp –dport 135:139 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -p tcp –dport 445 -j DROP #Droping Samba<br> $IPTABLES -A FORWARD -i $INET_IFACE -o $LAN_IFACE -j DROP</p><p>echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;32m OUTPUT RULING (accept) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A OUTPUT -p tcp –tcp-flags SYN,RST SYN -j TCPMSS –clamp-mss-to-pmtu<br> $IPTABLES -A OUTPUT -p all -m state –state ESTABLISHED,RELATED -j ACCEPT<br> $IPTABLES -A OUTPUT -p ICMP -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP –dport 20 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP –dport 21 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP –dport 22 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP –dport 25 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP –dport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP –dport 123 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP –dport 123 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -s 22.23.24.144 -d 0.0.0.0/0 –sport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -s 22.23.24.144 -d 14.15.16.18 –dport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -o $INET_IFACE –sport 53 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -d 0/0 –dport 80 -j ACCEPT<br> $IPTABLES -A OUTPUT -p TCP -d 0/0 –dport 443 -j ACCEPT<br> $IPTABLES -A OUTPUT -p tcp -d 192.168.0.2 –dport 6000 -j ACCEPT<br> $IPTABLES -A OUTPUT -p UDP -s 22.23.24.144 –sport 53 -j ACCEPT</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;31mOUTPUT RULING (drop) \033[0m &lt;-&nbsp;»<br> $IPTABLES -A OUTPUT -p tcp -d 0/0 –sport 135:139 -j DROP<br> $IPTABLES -A OUTPUT -p udp -d 0/0 –sport 135:139 -j DROP<br> $IPTABLES -A OUTPUT -p udp -d 0/0 –sport 445 -j DROP<br> #$IPTABLES -A OUTPUT -p all -d 0/0 -j DROP</p><p>echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;33m ADSL connexion clamping &amp; Masquerading \033[0m &lt;-&nbsp;»<br> $IPTABLES -t nat -A POSTROUTING -p tcp –tcp-flags SYN,RST SYN -j TCPMSS –clamp-mss-to-pmtu<br> $IPTABLES -t nat -A POSTROUTING -o $INET_IFACE -j MASQUERADE</p><p>echo «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;31mBANNING INPUT &amp; FORWARD FOR RESERVED &amp; EVIL IPs \033[0m &lt;-&nbsp;»<br> for net in $RESERVED_NET; do<br> $IPTABLES -A INPUT -i $INET_IFACE -s $net -j LOG_DROP<br> $IPTABLES -A FORWARD -i $INET_IFACE -s $net -j LOG_DROP<br> done</p><p>#for banned in $BANNED_IP; do<br> #$IPTABLES -A INPUT -i $INET_IFACE -s $banned -m limit –limit 6/h –limit-burst 1 -j LOG –log-prefix «&nbsp;Banned IP: «&nbsp;<br> #$IPTABLES -A INPUT -i $INET_IFACE -s $banned -j DROP<br>
 #$IPTABLES -A FORWARD -i $INET_IFACE -s $banned -m limit –limit 6/h 
–limit-burst 1 -j LOG –log-prefix «&nbsp;Drop fwd of Banned IP: «&nbsp;<br> #$IPTABLES -A FORWARD -i $INET_IFACE -s $banned -j DROP<br> #done</p><p>echo -e «&nbsp;-&gt; \033[40m\033[1;32m Activating Forward \033[0m &lt;-&nbsp;»<br> echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p><p>echo «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;————————&gt; \033[40m\033[1;32mEOF : End of Firewall \033[0m&lt;———————–&nbsp;»<br> echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; \033[40m\033[1;32m Spawning log console to $DISPLAY \033[0m&lt;-&nbsp;»<br> echo -e «&nbsp;-&gt; &lt;-&nbsp;»<br> echo -e «&nbsp;————————&gt;\033[40m\033[1;32m ALL DONE ! \033[0m&lt;————————&nbsp;»<br> echo &nbsp;» «&nbsp;</p><p>;;</p><p>stop)<br> echo -e «&nbsp;\033[40m\033[1;31m———————-&gt; Shutting down Firewall ! &lt;———————-\033[0m&nbsp;»<br> echo &nbsp;» «&nbsp;<br> IPTABLES=&nbsp;»/sbin/iptables&nbsp;»<br> $IPTABLES -F<br> $IPTABLES -X<br> $IPTABLES -Z<br> $IPTABLES -F INPUT<br> $IPTABLES -F OUTPUT<br> $IPTABLES -F FORWARD<br> $IPTABLES -t nat -F<br> $IPTABLES -t nat -Z<br> $IPTABLES -t nat -X<br> #$IPTABLES -t mangle -Z<br> #$IPTABLES -t mangle -F<br> #$IPTABLES -t mangle -X<br> echo 0 &gt; /proc/sys/net/ipv4/ip_forward<br> echo &nbsp;» «&nbsp;<br> echo «&nbsp;-&gt; DONE ! &lt;-&nbsp;»<br> ;;<br> *)<br> echo «&nbsp;Usage: /etc/init.d/firewall {start|stop}&nbsp;»<br> exit 1<br> ;;<br> esac<br> exit 0</p></div><p><a title="Remonter en haut de la page" href="http://www.nbs-system.com/blog/howto-iptables.html#top">(up)</a></p><style>*{margin:0;padding:0}ul{list-style:none}#socialbuttonnav{width:90%;overflow:hidden;margin:0 auto}#socialbuttonnav li{background:none;overflow:hidden;width:65px;height:80px;line-height:30px;margin-right:2px;float:left;text-align:center}#fb{text-align:center;border:none}#fb iframe{text-align:center;float:left}</style><ul id="socialbuttonnav"><li><div><iframe title="Twitter Tweet Button" style="width: 65px; height: 62px;" class="twitter-share-button twitter-count-vertical" src="howto-iptables_files/tweet_button.htm" allowtransparency="true" frameborder="0" scrolling="no"></iframe></div></li><li><div><div style="height: 60px; width: 50px; display: inline-block; text-indent: 0pt; margin: 0pt; padding: 0pt; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline;" id="___plusone_0"><iframe allowtransparency="true" hspace="0" id="I1_1327413063647" marginheight="0" marginwidth="0" name="I1_1327413063647" src="howto-iptables_files/fastbutton.htm" style="position: static; left: 0pt; top: 0pt; width: 50px; margin: 0px; border-style: none; height: 60px; visibility: visible;" tabindex="-1" vspace="0" title="+1" frameborder="0" scrolling="no" width="100%"></iframe></div></div></li><li><div><script src="howto-iptables_files/hostedbadge.htm"></script><iframe id="iframe-stmblpn-widget-1" src="howto-iptables_files/a.htm" style="overflow: hidden; margin: 0pt; padding: 0pt; border: 0pt none;" allowtransparency="true" frameborder="0" height="60" scrolling="no" width="50"></iframe> <script type="text/javascript">   (function() {     var li = document.createElement('script'); li.type = 'text/javascript'; li.async = true;     li.src = 'https://platform.stumbleupon.com/1/widgets.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(li, s);   })(); </script></div></li><li><div><span class="IN-widget" style="line-height: 1; vertical-align: baseline; display: inline-block; text-align: center;"><span style="padding: 0pt ! important; margin: 0pt ! important; text-indent: 0pt ! important; display: inline-block ! important; vertical-align: baseline ! important; font-size: 1px ! important;"><span id="li_ui_li_gen_1327413064014_1-container" class="IN-top IN-empty"><span id="li_ui_li_gen_1327413064014_1" class="IN-top"><span id="li_ui_li_gen_1327413064014_1-inner" class="IN-top"><span id="li_ui_li_gen_1327413064014_1-content" class="IN-top">0</span></span></span></span></span><br><span style="padding: 0pt ! important; margin: 0pt ! important; text-indent: 0pt ! important; display: inline-block ! important; vertical-align: baseline ! important; font-size: 1px ! important;"><span id="li_ui_li_gen_1327413063996_0"><a id="li_ui_li_gen_1327413063996_0-link" href="javascript:void(0);"><span id="li_ui_li_gen_1327413063996_0-logo">in</span><span id="li_ui_li_gen_1327413063996_0-title"><span id="li_ui_li_gen_1327413063996_0-mark"></span><span id="li_ui_li_gen_1327413063996_0-title-text">Share</span></span></a></span></span></span><script type="in/share+init" data-counter="top"></script></div></li><li><div><span class="db-wrapper db-clear db-medium"><span><span class="db-container db-submit"><span class="db-body db-medium"><span class="db-count">0</span><span class="db-copy">diggs</span><a class="db-anchor">digg</a></span></span></span></span></div></li><li><div><a title="Post to Google Buzz" class="google-buzz-button" href="http://www.google.com/buzz/post" data-button-style="normal-count"></a></div></li><li><div id="fb-root"></div><script src="howto-iptables_files/all.js"></script><fb:like class=" fb_edge_widget_with_comment fb_iframe_widget" href="" send="false" layout="box_count" width="64" show_faces="false" action="like" font=""><span><iframe src="howto-iptables_files/like.htm" class="fb_ltr" title="Like this content on Facebook." style="border: medium none; overflow: hidden; height: 62px; width: 64px;" name="f594933a51d49e" id="f3411c37f5acfb4" scrolling="no"></iframe></span></fb:like></li></ul></div><p class="postmetadata"> Par philippe - <span class="comments"><span>Comments Closed</span></span></p></div><div class="navigation"><div class="alignleft"></div><div class="alignright"></div></div><div id="single-commentaire"><p class="nocomments">Comments are closed.</p></div></div><div class="footer"></div></div><div id="sidebar" role="complementary"><ul><li id="categories-4" class="widget widget_categories"><div class="header"><h2 class="widgettitle">Catégorie</h2></div><div class="content"><ul><li class="cat-item cat-item-50"><a href="http://www.nbs-system.com/categorie/blog/securite-blog" title="Voir tous les articles classés dans Sécurité">Sécurité</a></li><li class="cat-item cat-item-23"><a href="http://www.nbs-system.com/categorie/blog/technique" title="Voir tous les articles classés dans Technique">Technique</a><ul class="children"><li class="cat-item cat-item-67"><a href="http://www.nbs-system.com/categorie/blog/technique/faq" title="La FAQ du parfait Hébergé">FAQ</a></li><li class="cat-item cat-item-24"><a href="http://www.nbs-system.com/categorie/blog/technique/magento" title="Voir tous les articles classés dans Magento">Magento</a><ul class="children"><li class="cat-item cat-item-143"><a href="http://www.nbs-system.com/categorie/blog/technique/magento/nitrogento-magento" title="Voir tous les articles classés dans Nitrogento">Nitrogento</a></li></ul></li></ul></li></ul></div><div class="footer"></div></li><li id="categories-4" class="widget widget_recent_post"><div class="header"><h2 class="widgettitle">Articles récents</h2></div><div class="content"><ul><li><a href="http://www.nbs-system.com/blog/200-sur-la-bp.html">+200% sur la BP !</a></li><li><a href="http://www.nbs-system.com/blog/optimisez-et-animez-votre-site-marchand-pour-mieux-vendre.html">Optimisez et animez votre site marchand pour mieux vendre !</a></li><li><a href="http://www.nbs-system.com/blog/securite-blog/resultats-de-notre-etude.html">Résultats de notre étude</a></li><li><a href="http://www.nbs-system.com/blog/e-commerce-folks-le-rendez-vous-des-experts-ecommerce.html">E-commerce Folks, le rendez-vous des experts E-commerce</a></li><li><a href="http://www.nbs-system.com/blog/securite-blog/votre-hebergement-tres-haute-securite.html">Votre Hébergement Très Haute Sécurité</a></li></ul></div><div class="footer"></div></li><li><a href="http://www.nbs-system.com/rss/" class="picto-rss">Suivez-nous</a></li></ul></div></div><div id="header-container"><div id="header" class="divcenter clearfix"> <strong id="logo"> <a href="http://www.nbs-system.com/" title="test d'intrusion, hébergement Magento et E-commerce">test d'intrusion, hébergement Magento et E-commerce</a> </strong><p class="slogan">" Grow your business safely "</p><div id="lang_sel_list"><ul><li class="icl-en"> <a href="http://www.nbs-system.co.uk/" class="lang_sel_other"> <img class="iclflag" src="howto-iptables_files/en.png" alt="en" height="12px" width="18px">&nbsp;
Anglais </a></li><li class="icl-es"> <a href="http://www.nbs-system.es/" class="lang_sel_other"> <img class="iclflag" src="howto-iptables_files/es.png" alt="es" height="12px" width="18px">&nbsp;
Espagnol </a></li><li class="icl-fr"> <a href="http://www.nbs-system.com/blog/howto-iptables.html" class="lang_sel_sel"> <img class="iclflag" src="howto-iptables_files/fr.png" alt="fr" height="12px" width="18px">&nbsp;
Français </a></li></ul></div><div id="navigation" class="clearfix"><ul><li id="menu-item-1338" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1338"><a href="http://www.nbs-system.com/securite-informatique"><span>Sécurité Informatique</span></a><ul class="sub-menu"><li id="menu-item-1699" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1699"><a href="http://www.nbs-system.com/tests-de-securite-informatique"><span>Test de sécurité</span></a></li><li id="menu-item-1359" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1359"><a href="http://www.nbs-system.com/audit-de-securite-informatique"><span>Audit de sécurité informatique</span></a></li><li id="menu-item-1358" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1358"><a href="http://www.nbs-system.com/conseil-accompagnement"><span>Conseil &amp; accompagnement</span></a></li><li id="menu-item-1819" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1819"><a href="http://www.nbs-system.com/formations-securite-informatique"><span>Formations Sécurité Informatique</span></a></li><li id="menu-item-1341" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1341"><a href="http://www.nbs-system.com/arjel-certification"><span>Certification ARJEL</span></a></li><div class="pointe"></div></ul></li><li id="menu-item-1357" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1357"><a href="http://www.nbs-system.com/hebergement-infogerance"><span>Hébergement &amp; Infogérance</span></a><ul class="sub-menu"><li id="menu-item-1356" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1356"><a href="http://www.nbs-system.com/hebergement-ecommerce"><span>Hébergement E-commerce</span></a></li><li id="menu-item-1351" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1351"><a href="http://www.nbs-system.com/hebergement-opensource"><span>Hébergement Opensource</span></a></li><li id="menu-item-1350" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1350"><a title="Cloud privé Ecommerce" href="http://www.nbs-system.com/cloud-computing"><span>Cloud computing</span></a></li><li id="menu-item-1352" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1352"><a title="Conseil &amp; optimisation performance" href="http://www.nbs-system.com/conseil-optimisation-performance"><span>Conseil en optimisation</span></a></li><li id="menu-item-1405" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1405"><a href="http://www.nbs-system.com/vpn-pos"><span>VPN POS (point de ventes)</span></a></li><li id="menu-item-1354" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1354"><a title="Infrastructure haute disponibilité" href="http://www.nbs-system.com/infrastructure-haute-disponibilite"><span>Notre infrastructure</span></a></li><div class="pointe"></div></ul></li><li id="menu-item-1355" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1355"><a href="http://www.nbs-system.com/societe"><span>Société</span></a><ul class="sub-menu"><li id="menu-item-1343" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1343"><a title="NBS System contact" href="http://www.nbs-system.com/contact"><span><strong>Contact</strong></span></a></li><li id="menu-item-1342" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1342"><a href="http://www.nbs-system.com/demander-un-devis"><span><strong>Demander un devis</strong></span></a></li><li id="menu-item-1344" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1344"><a href="http://www.nbs-system.com/qui-sommes-nous"><span>Qui sommes-nous ?</span></a></li><li id="menu-item-1346" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1346"><a title="Logiciels édités par NBS System (Naxsi, Nitrogento)" href="http://www.nbs-system.com/nos-logiciels"><span>Nos logiciels</span></a></li><li id="menu-item-1348" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1348"><a title="références Ecommerce" href="http://www.nbs-system.com/references"><span>Références</span></a></li><li id="menu-item-1345" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1345"><a href="http://www.nbs-system.com/nos-partenaires"><span>Nos partenaires</span></a></li><li id="menu-item-1347" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1347"><a href="http://www.nbs-system.com/recrutement"><span>Recrutement / CV</span></a></li><div class="pointe"></div></ul></li><li id="menu-item-1349" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-1349"><a href="http://www.nbs-system.com/blog"><span>Blog</span></a></li></ul><ul id="search-ul"><li><a id="search-link" href="#searchform" title="Recherche"><span><em id="picto-recherche">Recherche</em> </span></a></li></ul><form method="get" id="searchform" action="http://www.nbs-system.com/"><div> <label class="hidden" for="s">Rechercher pour&nbsp;:</label> <input name="s" id="s" type="text"> <input id="searchsubmit" value="Chercher" type="submit"></div><div class="pointe"></div></form></div> <a href="http://www.nbs-system.com/contact" title="Contactez nous"> <span id="bloc-adresse"> <span id="hcard-header" class="vcard"> <strong class="fn org">NBS System</strong> <span class="adr address"> <span class="street-address">140 boulevard Haussmann</span><br> <span class="postal-code locality">75008 Paris</span><br> </span> <strong class="tel">+33 1 58 56 60 80</strong> </span> </span> </a><p id="breadcrumbs" class="grid_12"><a href="http://www.nbs-system.com/">Accueil</a> » <a href="http://www.nbs-system.com/blog">Blog</a> » <a href="http://www.nbs-system.com/categorie/blog">Blog</a> » <strong>Howto Iptables / Netfilter</strong></p></div></div><div class="clearer"></div><div id="footer-container"><div id="footer" class="divcenter clearfix"><div class="grid_4 apropos"><h4>A propos de NBS System</h4><p>Notre
 société, fondée il y a 12 ans, est spécialisée dans la sécurité 
informatique, les audits de sécurité, l'hébergement de serveurs et de 
sites E-commerce (notamment sous Magento, Prestashop, etc.)</p></div> <a href="http://www.nbs-system.com/contact" class="recontact">Recontactez-moi</a> <a href="http://www.nbs-system.com/demander-un-devis" class="devis">Demander un devis Complet</a><p class="grid_7">© 1999-2011. Tous droits réservés. Entreprise spécialisée dans la sécurité informatique</p><ul id="footer-navigation" class="nols"><li id="menu-item-1014" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1014"><a href="http://www.nbs-system.com/mentions-legales"><span>Mentions Légales</span></a></li><li id="menu-item-1015" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1015"><a href="http://www.nbs-system.com/credits"><span>Crédits</span></a></li><li id="menu-item-1016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1016"><a href="http://www.nbs-system.com/plan-du-site"><span>Plan du site</span></a></li></ul></div></div></div></div><script gapi_processed="true" type="text/javascript" src="howto-iptables_files/plusone.js"></script><script type="text/javascript" src="howto-iptables_files/button.js"></script><script type="text/javascript" src="howto-iptables_files/widgets_002.js"></script><script src="howto-iptables_files/in.js" type="text/javascript"></script><script type="text/javascript">(function(){var s=document.createElement('SCRIPT'),s1=document.getElementsByTagName('SCRIPT')[0];s.type='text/javascript';s.async=true;s.src='http://widgets.digg.com/buttons.js';s1.parentNode.insertBefore(s,s1);})();</script><script type="text/javascript" src="howto-iptables_files/jquery.js"></script>
</body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Minified using apc
Page Caching using disk: enhanced
Database Caching 157/187 queries in 0.017 seconds using apc
Object Caching 1265/1293 objects using apc
Content Delivery Network via cdn1.nbs-system.com

Served from: www.nbs-system.com @ 2012-01-24 13:52:29 -->